/*!
 * Package name: wallkit-js-sdk.
 * Package description: Wallkit.
 * Package version: 0.0.53.
 */
var Wallkit=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=11)}([function(e,t,n){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function o(e,t,n){return(t=s(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){var t=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===r(t)?t:String(t)}n.d(t,"a",(function(){return l}));var a,u,c,l=(a=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)},u&&i(a.prototype,u),c&&i(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a);o(l,"api_url","https://api.wallkit.net/api/v1"),o(l,"resource",null),o(l,"debug",!0),o(l,"subDomainCookie",!1)},function(e,t,n){"use strict";(function(e){var r=n(0),i=n(10),o={getItem:function(e){return e&&decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null},setItem:function(e,t,n,r,i,o){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return!1;var s="";if(n)switch(n.constructor){case Number:s=n===1/0?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+n;break;case String:s="; expires="+n;break;case Date:s="; expires="+n.toUTCString()}return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+s+(i?"; domain="+i:"")+(r?"; path="+r:"")+(o?"; secure":""),!0},removeItem:function(e,t,n){return!!this.hasItem(e)&&(document.cookie=encodeURIComponent(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(n?"; domain="+n:"")+(t?"; path="+t:""),!0)},hasItem:function(e){return!!e&&new RegExp("(?:^|;\\s*)"+encodeURIComponent(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)},keys:function(){for(var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),t=e.length,n=0;n<t;n++)e[n]=decodeURIComponent(e[n]);return e},cookieDomain:function(){return r.a.subDomainCookie?".".concat(Object(i.a)(window.location)):""}};void 0!==e.exports&&(e.exports=o),t.a=o}).call(this,n(15)(e))},function(e,t,n){var r={setItem:function(e,t){return this.isAvailable()?window.localStorage.setItem(e,t):null},getItem:function(e){return this.isAvailable()?window.localStorage.getItem(e):null},removeItem:function(e){if(this.isAvailable())return window.localStorage.removeItem(e)},isAvailable:function(){try{return localStorage.setItem("",""),localStorage.removeItem(""),!0}catch(e){return!1}}};void 0!==e.exports&&(e.exports=r)},function(e,t,n){void 0!==e.exports&&(e.exports={formatKey:function(e,t){return"".concat(e,"_").concat(t)}})},function(e,t){var n=/^(?:0|[1-9]\d*)$/;function r(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}var i,o,s=Object.prototype,a=s.hasOwnProperty,u=s.toString,c=s.propertyIsEnumerable,l=(i=Object.keys,o=Object,function(e){return i(o(e))}),f=Math.max,h=!c.call({valueOf:1},"valueOf");function p(e,t){var n=m(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&g(e)}(e)&&a.call(e,"callee")&&(!c.call(e,"callee")||"[object Arguments]"==u.call(e))}(e)?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],r=n.length,i=!!r;for(var o in e)!t&&!a.call(e,o)||i&&("length"==o||v(o,r))||n.push(o);return n}function d(e,t,n){var r=e[t];a.call(e,t)&&_(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function v(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||n.test(e))&&e>-1&&e%1==0&&e<t}function y(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||s)}function _(e,t){return e===t||e!=e&&t!=t}var m=Array.isArray;function g(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!function(e){var t=b(e)?u.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}(e)}function b(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}var k,w=(k=function(e,t){if(h||y(t)||g(t))!function(e,t,n,r){n||(n={});for(var i=-1,o=t.length;++i<o;){var s=t[i],a=r?r(n[s],e[s],s,n,e):void 0;d(n,s,void 0===a?e[s]:a)}}(t,function(e){return g(e)?p(e):function(e){if(!y(e))return l(e);var t=[];for(var n in Object(e))a.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)}(t),e);else for(var n in t)a.call(t,n)&&d(e,n,t[n])},function(e,t){return t=f(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,o=f(n.length-t,0),s=Array(o);++i<o;)s[i]=n[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=n[i];return a[t]=s,r(e,this,a)}}((function(e,t){var n=-1,r=t.length,i=r>1?t[r-1]:void 0,o=r>2?t[2]:void 0;for(i=k.length>3&&"function"==typeof i?(r--,i):void 0,o&&function(e,t,n){if(!b(n))return!1;var r=typeof t;return!!("number"==r?g(n)&&v(t,n.length):"string"==r&&t in n)&&_(n[t],e)}(t[0],t[1],o)&&(i=r<3?void 0:i,r=1),e=Object(e);++n<r;){var s=t[n];s&&k(e,s,n,i)}return e})));e.exports=w},function(e,t,n){(function(e,n){var r="[object Map]",i="[object Set]",o=/^\[object .+?Constructor\]$/,s="object"==typeof e&&e&&e.Object===Object&&e,a="object"==typeof self&&self&&self.Object===Object&&self,u=s||a||Function("return this")(),c=t&&!t.nodeType&&t,l=c&&"object"==typeof n&&n&&!n.nodeType&&n,f=l&&l.exports===c;var h,p,d,v=Function.prototype,y=Object.prototype,_=u["__core-js_shared__"],m=(h=/[^.]+$/.exec(_&&_.keys&&_.keys.IE_PROTO||""))?"Symbol(src)_1."+h:"",g=v.toString,b=y.hasOwnProperty,k=y.toString,w=RegExp("^"+g.call(b).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),j=f?u.Buffer:void 0,C=y.propertyIsEnumerable,E=j?j.isBuffer:void 0,T=(p=Object.keys,d=Object,function(e){return p(d(e))}),S=N(u,"DataView"),P=N(u,"Map"),F=N(u,"Promise"),x=N(u,"Set"),O=N(u,"WeakMap"),R=!C.call({valueOf:1},"valueOf"),A=H(S),I=H(P),U=H(F),D=H(x),L=H(O);function B(e){return!(!q(e)||function(e){return!!m&&m in e}(e))&&($(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?w:o).test(H(e))}function N(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return B(n)?n:void 0}var M=function(e){return k.call(e)};function H(e){if(null!=e){try{return g.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function V(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&K(e)}(e)&&b.call(e,"callee")&&(!C.call(e,"callee")||"[object Arguments]"==k.call(e))}(S&&"[object DataView]"!=M(new S(new ArrayBuffer(1)))||P&&M(new P)!=r||F&&"[object Promise]"!=M(F.resolve())||x&&M(new x)!=i||O&&"[object WeakMap]"!=M(new O))&&(M=function(e){var t=k.call(e),n="[object Object]"==t?e.constructor:void 0,o=n?H(n):void 0;if(o)switch(o){case A:return"[object DataView]";case I:return r;case U:return"[object Promise]";case D:return i;case L:return"[object WeakMap]"}return t});var W=Array.isArray;function K(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!$(e)}var z=E||function(){return!1};function $(e){var t=q(e)?k.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}function q(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}n.exports=function(e){if(K(e)&&(W(e)||"string"==typeof e||"function"==typeof e.splice||z(e)||V(e)))return!e.length;var t=M(e);if(t==r||t==i)return!e.size;if(R||function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||y)}(e))return!T(e).length;for(var n in e)if(b.call(e,n))return!1;return!0}}).call(this,n(6),n(16)(e))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){var n=/^(?:0|[1-9]\d*)$/;var r=Object.prototype,i=r.hasOwnProperty,o=r.toString,s=r.propertyIsEnumerable;function a(e,t){var n=l(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&f(e)}(e)&&i.call(e,"callee")&&(!s.call(e,"callee")||"[object Arguments]"==o.call(e))}(e)?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],r=n.length,a=!!r;for(var u in e)!t&&!i.call(e,u)||a&&("length"==u||c(u,r))||n.push(u);return n}function u(e){if(!h(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t,n,o,s=(n=(t=e)&&t.constructor,o="function"==typeof n&&n.prototype||r,t===o),a=[];for(var u in e)("constructor"!=u||!s&&i.call(e,u))&&a.push(u);return a}function c(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||n.test(e))&&e>-1&&e%1==0&&e<t}var l=Array.isArray;function f(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!function(e){var t=h(e)?o.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}(e)}function h(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}e.exports=function(e){return f(e)?a(e,!0):u(e)}},function(e,t,n){(function(t,n,r){var i;i=function(){var e,i,o;return function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof _dereq_&&_dereq_;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};t[s][0].call(l.exports,(function(e){var n=t[s][1][e];return i(n||e)}),l,l.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof _dereq_&&_dereq_,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){"use strict";t.exports=function(e){var t=e._SomePromiseArray;function n(e){var n=new t(e),r=n.promise();return n.setHowMany(1),n.setUnwrap(),n.init(),r}e.any=function(e){return n(e)},e.prototype.any=function(){return n(this)}}},{}],2:[function(e,n,r){"use strict";var i;try{throw new Error}catch(e){i=e}var o=e("./schedule"),s=e("./queue");function a(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new s(16),this._normalQueue=new s(16),this._haveDrainedQueues=!1;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=o}function u(e){for(;e.length()>0;)c(e)}function c(e){var t=e.shift();if("function"!=typeof t)t._settlePromises();else{var n=e.shift(),r=e.shift();t.call(n,r)}}a.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},a.prototype.hasCustomScheduler=function(){return this._customScheduler},a.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},a.prototype.fatalError=function(e,n){n?(t.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),t.exit(2)):this.throwLater(e)},a.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout((function(){e(t)}),0);else try{this._schedule((function(){e(t)}))}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},a.prototype.invokeLater=function(e,t,n){this._lateQueue.push(e,t,n),this._queueTick()},a.prototype.invoke=function(e,t,n){this._normalQueue.push(e,t,n),this._queueTick()},a.prototype.settlePromises=function(e){this._normalQueue._pushOne(e),this._queueTick()},a.prototype._drainQueues=function(){u(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,u(this._lateQueue)},a.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},a.prototype._reset=function(){this._isTickUsed=!1},n.exports=a,n.exports.firstLineError=i},{"./queue":26,"./schedule":29}],3:[function(e,t,n){"use strict";t.exports=function(e,t,n,r){var i=!1,o=function(e,t){this._reject(t)},s=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(o,o,null,this,e)},a=function(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},u=function(e,t){t.promiseRejectionQueued||this._reject(e)};e.prototype.bind=function(o){i||(i=!0,e.prototype._propagateFrom=r.propagateFromFunction(),e.prototype._boundValue=r.boundValueFunction());var c=n(o),l=new e(t);l._propagateFrom(this,1);var f=this._target();if(l._setBoundTo(c),c instanceof e){var h={promiseRejectionQueued:!1,promise:l,target:f,bindingPromise:c};f._then(t,s,void 0,l,h),c._then(a,u,void 0,l,h),l._setOnCancel(c)}else l._resolveCallback(f);return l},e.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=-2097153&this._bitField},e.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},e.bind=function(t,n){return e.resolve(n).bind(t)}}},{}],4:[function(e,t,n){"use strict";var r;"undefined"!=typeof Promise&&(r=Promise);var i=e("./promise")();i.noConflict=function(){try{Promise===i&&(Promise=r)}catch(e){}return i},t.exports=i},{"./promise":22}],5:[function(e,t,n){"use strict";var r=Object.create;if(r){var i=r(null),o=r(null);i[" size"]=o[" size"]=0}t.exports=function(t){var n=e("./util"),r=n.canEvaluate;function i(e){return function(e,r){var i;if(null!=e&&(i=e[r]),"function"!=typeof i){var o="Object "+n.classString(e)+" has no method '"+n.toString(r)+"'";throw new t.TypeError(o)}return i}(e,this.pop()).apply(e,this)}function o(e){return e[this]}function s(e){var t=+this;return t<0&&(t=Math.max(0,t+e.length)),e[t]}n.isIdentifier,t.prototype.call=function(e){var t=[].slice.call(arguments,1);return t.push(e),this._then(i,void 0,void 0,t,void 0)},t.prototype.get=function(e){var t;if("number"==typeof e)t=s;else if(r){var n=(void 0)(e);t=null!==n?n:o}else t=o;return this._then(t,void 0,void 0,e,void 0)}}},{"./util":36}],6:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){var o=e("./util"),s=o.tryCatch,a=o.errorObj,u=t._async;t.prototype.break=t.prototype.cancel=function(){if(!i.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var n=e._cancellationParent;if(null==n||!n._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=n}},t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},t.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),u.invoke(this._cancelPromises,this,void 0))},t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},t.prototype._unsetOnCancel=function(){this._onCancelField=void 0},t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},t.prototype._doInvokeOnCancel=function(e,t){if(o.isArray(e))for(var n=0;n<e.length;++n)this._doInvokeOnCancel(e[n],t);else if(void 0!==e)if("function"==typeof e){if(!t){var r=s(e).call(this._boundValue());r===a&&(this._attachExtraTrace(r.e),u.throwLater(r.e))}}else e._resultCancelled(this)},t.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),u.invoke(this._doInvokeOnCancel,this,e)},t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(e,t,n){"use strict";t.exports=function(t){var n=e("./util"),r=e("./es5").keys,i=n.tryCatch,o=n.errorObj;return function(e,s,a){return function(u){var c=a._boundValue();e:for(var l=0;l<e.length;++l){var f=e[l];if(f===Error||null!=f&&f.prototype instanceof Error){if(u instanceof f)return i(s).call(c,u)}else if("function"==typeof f){var h=i(f).call(c,u);if(h===o)return h;if(h)return i(s).call(c,u)}else if(n.isObject(u)){for(var p=r(f),d=0;d<p.length;++d){var v=p[d];if(f[v]!=u[v])continue e}return i(s).call(c,u)}}return t}}}},{"./es5":13,"./util":36}],8:[function(e,t,n){"use strict";t.exports=function(e){var t=!1,n=[];function r(){this._trace=new r.CapturedTrace(i())}function i(){var e=n.length-1;if(e>=0)return n[e]}return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},r.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,n.push(this._trace))},r.prototype._popContext=function(){if(void 0!==this._trace){var e=n.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},r.CapturedTrace=null,r.create=function(){if(t)return new r},r.deactivateLongStackTraces=function(){},r.activateLongStackTraces=function(){var n=e.prototype._pushContext,o=e.prototype._popContext,s=e._peekContext,a=e.prototype._peekContext,u=e.prototype._promiseCreated;r.deactivateLongStackTraces=function(){e.prototype._pushContext=n,e.prototype._popContext=o,e._peekContext=s,e.prototype._peekContext=a,e.prototype._promiseCreated=u,t=!1},t=!0,e.prototype._pushContext=r.prototype._pushContext,e.prototype._popContext=r.prototype._popContext,e._peekContext=e.prototype._peekContext=i,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},r}},{}],9:[function(e,n,r){"use strict";n.exports=function(n,r,i,o){var s,a,u,c,l=n._async,f=e("./errors").Warning,h=e("./util"),p=e("./es5"),d=h.canAttachTrace,v=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,y=/\((?:timers\.js):\d+:\d+\)/,_=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,m=null,g=null,b=!1,k=!(0==h.env("BLUEBIRD_DEBUG")),w=!(0==h.env("BLUEBIRD_WARNINGS")||!k&&!h.env("BLUEBIRD_WARNINGS")),j=!(0==h.env("BLUEBIRD_LONG_STACK_TRACES")||!k&&!h.env("BLUEBIRD_LONG_STACK_TRACES")),C=0!=h.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(w||!!h.env("BLUEBIRD_W_FORGOTTEN_RETURN"));!function(){var e=[];function t(){for(var t=0;t<e.length;++t)e[t]._notifyUnhandledRejection();r()}function r(){e.length=0}c=function(n){e.push(n),setTimeout(t,1)},p.defineProperty(n,"_unhandledRejectionCheck",{value:t}),p.defineProperty(n,"_unhandledRejectionClear",{value:r})}(),n.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=-1048577&e._bitField|524288},n.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),c(this))},n.prototype._notifyUnhandledRejectionIsHandled=function(){G("rejectionHandled",s,void 0,this)},n.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},n.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},n.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),G("unhandledRejection",a,e,this)}},n.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},n.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},n.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},n.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},n.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},n.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},n.prototype._warn=function(e,t,n){return K(e,t,n||this)},n.onPossiblyUnhandledRejection=function(e){var t=n._getContext();a=h.contextBind(t,e)},n.onUnhandledRejectionHandled=function(e){var t=n._getContext();s=h.contextBind(t,e)};var E=function(){};n.longStackTraces=function(){if(l.haveItemsQueued()&&!ne.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!ne.longStackTraces&&X()){var e=n.prototype._captureStackTrace,t=n.prototype._attachExtraTrace,i=n.prototype._dereferenceTrace;ne.longStackTraces=!0,E=function(){if(l.haveItemsQueued()&&!ne.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");n.prototype._captureStackTrace=e,n.prototype._attachExtraTrace=t,n.prototype._dereferenceTrace=i,r.deactivateLongStackTraces(),ne.longStackTraces=!1},n.prototype._captureStackTrace=H,n.prototype._attachExtraTrace=V,n.prototype._dereferenceTrace=W,r.activateLongStackTraces()}},n.hasLongStackTraces=function(){return ne.longStackTraces&&X()};var T={unhandledrejection:{before:function(){var e=h.global.onunhandledrejection;return h.global.onunhandledrejection=null,e},after:function(e){h.global.onunhandledrejection=e}},rejectionhandled:{before:function(){var e=h.global.onrejectionhandled;return h.global.onrejectionhandled=null,e},after:function(e){h.global.onrejectionhandled=e}}},S=function(){var e=function(e,t){if(!e)return!h.global.dispatchEvent(t);var n;try{return n=e.before(),!h.global.dispatchEvent(t)}finally{e.after(n)}};try{if("function"==typeof CustomEvent){var t=new CustomEvent("CustomEvent");return h.global.dispatchEvent(t),function(t,n){t=t.toLowerCase();var r=new CustomEvent(t,{detail:n,cancelable:!0});return p.defineProperty(r,"promise",{value:n.promise}),p.defineProperty(r,"reason",{value:n.reason}),e(T[t],r)}}return"function"==typeof Event?(t=new Event("CustomEvent"),h.global.dispatchEvent(t),function(t,n){t=t.toLowerCase();var r=new Event(t,{cancelable:!0});return r.detail=n,p.defineProperty(r,"promise",{value:n.promise}),p.defineProperty(r,"reason",{value:n.reason}),e(T[t],r)}):((t=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),h.global.dispatchEvent(t),function(t,n){t=t.toLowerCase();var r=document.createEvent("CustomEvent");return r.initCustomEvent(t,!1,!0,n),e(T[t],r)})}catch(e){}return function(){return!1}}(),P=h.isNode?function(){return t.emit.apply(t,arguments)}:h.global?function(e){var t="on"+e.toLowerCase(),n=h.global[t];return!!n&&(n.apply(h.global,[].slice.call(arguments,1)),!0)}:function(){return!1};function F(e,t){return{promise:t}}var x={promiseCreated:F,promiseFulfilled:F,promiseRejected:F,promiseResolved:F,promiseCancelled:F,promiseChained:function(e,t,n){return{promise:t,child:n}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,n){return{reason:t,promise:n}},rejectionHandled:F},O=function(e){var t=!1;try{t=P.apply(null,arguments)}catch(e){l.throwLater(e),t=!0}var n=!1;try{n=S(e,x[e].apply(null,arguments))}catch(e){l.throwLater(e),n=!0}return n||t};function R(){return!1}function A(e,t,n){var r=this;try{e(t,n,(function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+h.toString(e));r._attachCancellationCallback(e)}))}catch(e){return e}}function I(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?h.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function U(){return this._onCancelField}function D(e){this._onCancelField=e}function L(){this._cancellationParent=void 0,this._onCancelField=void 0}function B(e,t){if(0!=(1&t)){this._cancellationParent=e;var n=e._branchesRemainingToCancel;void 0===n&&(n=0),e._branchesRemainingToCancel=n+1}0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}n.config=function(e){if("longStackTraces"in(e=Object(e))&&(e.longStackTraces?n.longStackTraces():!e.longStackTraces&&n.hasLongStackTraces()&&E()),"warnings"in e){var t=e.warnings;ne.warnings=!!t,C=ne.warnings,h.isObject(t)&&"wForgottenReturn"in t&&(C=!!t.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!ne.cancellation){if(l.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");n.prototype._clearCancellationData=L,n.prototype._propagateFrom=B,n.prototype._onCancel=U,n.prototype._setOnCancel=D,n.prototype._attachCancellationCallback=I,n.prototype._execute=A,N=B,ne.cancellation=!0}if("monitoring"in e&&(e.monitoring&&!ne.monitoring?(ne.monitoring=!0,n.prototype._fireEvent=O):!e.monitoring&&ne.monitoring&&(ne.monitoring=!1,n.prototype._fireEvent=R)),"asyncHooks"in e&&h.nodeSupportsAsyncResource){var r=ne.asyncHooks,s=!!e.asyncHooks;r!==s&&(ne.asyncHooks=s,s?i():o())}return n},n.prototype._fireEvent=R,n.prototype._execute=function(e,t,n){try{e(t,n)}catch(e){return e}},n.prototype._onCancel=function(){},n.prototype._setOnCancel=function(e){},n.prototype._attachCancellationCallback=function(e){},n.prototype._captureStackTrace=function(){},n.prototype._attachExtraTrace=function(){},n.prototype._dereferenceTrace=function(){},n.prototype._clearCancellationData=function(){},n.prototype._propagateFrom=function(e,t){};var N=function(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)};function M(){var e=this._boundTo;return void 0!==e&&e instanceof n?e.isFulfilled()?e.value():void 0:e}function H(){this._trace=new ee(this._peekContext())}function V(e,t){if(d(e)){var n=this._trace;if(void 0!==n&&t&&(n=n._parent),void 0!==n)n.attachExtraTrace(e);else if(!e.__stackCleaned__){var r=$(e);h.notEnumerableProp(e,"stack",r.message+"\n"+r.stack.join("\n")),h.notEnumerableProp(e,"__stackCleaned__",!0)}}}function W(){this._trace=void 0}function K(e,t,r){if(ne.warnings){var i,o=new f(e);if(t)r._attachExtraTrace(o);else if(ne.longStackTraces&&(i=n._peekContext()))i.attachExtraTrace(o);else{var s=$(o);o.stack=s.message+"\n"+s.stack.join("\n")}O("warning",o)||q(o,"",!0)}}function z(e){for(var t=[],n=0;n<e.length;++n){var r=e[n],i="    (No stack trace)"===r||m.test(r),o=i&&J(r);i&&!o&&(b&&" "!==r.charAt(0)&&(r="    "+r),t.push(r))}return t}function $(e){var t=e.stack,n=e.toString();return t="string"==typeof t&&t.length>0?function(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),n=0;n<t.length;++n){var r=t[n];if("    (No stack trace)"===r||m.test(r))break}return n>0&&"SyntaxError"!=e.name&&(t=t.slice(n)),t}(e):["    (No stack trace)"],{message:n,stack:"SyntaxError"==e.name?t:z(t)}}function q(e,t,n){if("undefined"!=typeof console){var r;if(h.isObject(e)){var i=e.stack;r=t+g(i,e)}else r=t+String(e);"function"==typeof u?u(r,n):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(r)}}function G(e,t,n,r){var i=!1;try{"function"==typeof t&&(i=!0,"rejectionHandled"===e?t(r):t(n,r))}catch(e){l.throwLater(e)}"unhandledRejection"===e?O(e,n,r)||i||q(n,"Unhandled rejection "):O(e,r)}function Q(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{if(t=e&&"function"==typeof e.toString?e.toString():h.toString(e),/\[object [a-zA-Z0-9$_]+\]/.test(t))try{t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+function(e){return e.length<41?e:e.substr(0,38)+"..."}(t)+">, no stack trace)"}function X(){return"function"==typeof te}var J=function(){return!1},Y=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;function Z(e){var t=e.match(Y);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function ee(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);te(this,ee),t>32&&this.uncycle()}h.inherits(ee,Error),r.CapturedTrace=ee,ee.prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],n={},r=0,i=this;void 0!==i;++r)t.push(i),i=i._parent;for(r=(e=this._length=r)-1;r>=0;--r){var o=t[r].stack;void 0===n[o]&&(n[o]=r)}for(r=0;r<e;++r){var s=n[t[r].stack];if(void 0!==s&&s!==r){s>0&&(t[s-1]._parent=void 0,t[s-1]._length=1),t[r]._parent=void 0,t[r]._length=1;var a=r>0?t[r-1]:this;s<e-1?(a._parent=t[s+1],a._parent.uncycle(),a._length=a._parent._length+1):(a._parent=void 0,a._length=1);for(var u=a._length+1,c=r-2;c>=0;--c)t[c]._length=u,u++;return}}}},ee.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=$(e),n=t.message,r=[t.stack],i=this;void 0!==i;)r.push(z(i.stack.split("\n"))),i=i._parent;!function(e){for(var t=e[0],n=1;n<e.length;++n){for(var r=e[n],i=t.length-1,o=t[i],s=-1,a=r.length-1;a>=0;--a)if(r[a]===o){s=a;break}for(a=s;a>=0;--a){var u=r[a];if(t[i]!==u)break;t.pop(),i--}t=r}}(r),function(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}(r),h.notEnumerableProp(e,"stack",function(e,t){for(var n=0;n<t.length-1;++n)t[n].push("From previous event:"),t[n]=t[n].join("\n");return n<t.length&&(t[n]=t[n].join("\n")),e+"\n"+t.join("\n")}(n,r)),h.notEnumerableProp(e,"__stackCleaned__",!0)}};var te=function(){var e=/^\s*at\s*/,t=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():Q(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,m=e,g=t;var n=Error.captureStackTrace;return J=function(e){return v.test(e)},function(e,t){Error.stackTraceLimit+=6,n(e,t),Error.stackTraceLimit-=6}}var r,i=new Error;if("string"==typeof i.stack&&i.stack.split("\n")[0].indexOf("stackDetection@")>=0)return m=/@/,g=t,b=!0,function(e){e.stack=(new Error).stack};try{throw new Error}catch(e){r="stack"in e}return!("stack"in i)&&r&&"number"==typeof Error.stackTraceLimit?(m=e,g=t,function(e){Error.stackTraceLimit+=6;try{throw new Error}catch(t){e.stack=t.stack}Error.stackTraceLimit-=6}):(g=function(e,t){return"string"==typeof e?e:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?Q(t):t.toString()},null)}();"undefined"!=typeof console&&void 0!==console.warn&&(u=function(e){console.warn(e)},h.isNode&&t.stderr.isTTY?u=function(e,t){var n=t?"[33m":"[31m";console.warn(n+e+"[0m\n")}:h.isNode||"string"!=typeof(new Error).stack||(u=function(e,t){console.warn("%c"+e,t?"color: darkorange":"color: red")}));var ne={warnings:w,longStackTraces:!1,cancellation:!1,monitoring:!1,asyncHooks:!1};return j&&n.longStackTraces(),{asyncHooks:function(){return ne.asyncHooks},longStackTraces:function(){return ne.longStackTraces},warnings:function(){return ne.warnings},cancellation:function(){return ne.cancellation},monitoring:function(){return ne.monitoring},propagateFromFunction:function(){return N},boundValueFunction:function(){return M},checkForgottenReturns:function(e,t,n,r,i){if(void 0===e&&null!==t&&C){if(void 0!==i&&i._returnedNonUndefined())return;if(0==(65535&r._bitField))return;n&&(n+=" ");var o="",s="";if(t._trace){for(var a=t._trace.stack.split("\n"),u=z(a),c=u.length-1;c>=0;--c){var l=u[c];if(!y.test(l)){var f=l.match(_);f&&(o="at "+f[1]+":"+f[2]+":"+f[3]+" ");break}}if(u.length>0){var h=u[0];for(c=0;c<a.length;++c)if(a[c]===h){c>0&&(s="\n"+a[c-1]);break}}}var p="a promise was created in a "+n+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+s;r._warn(p,!0,t)}},setBounds:function(e,t){if(X()){for(var n,r,i=(e.stack||"").split("\n"),o=(t.stack||"").split("\n"),s=-1,a=-1,u=0;u<i.length;++u)if(c=Z(i[u])){n=c.fileName,s=c.line;break}for(u=0;u<o.length;++u){var c;if(c=Z(o[u])){r=c.fileName,a=c.line;break}}s<0||a<0||!n||!r||n!==r||s>=a||(J=function(e){if(v.test(e))return!0;var t=Z(e);return!!(t&&t.fileName===n&&s<=t.line&&t.line<=a)})}},warn:K,deprecated:function(e,t){var n=e+" is deprecated and will be removed in a future version.";return t&&(n+=" Use "+t+" instead."),K(n)},CapturedTrace:ee,fireDomEvent:S,fireGlobalEvent:P}}},{"./errors":12,"./es5":13,"./util":36}],10:[function(e,t,n){"use strict";t.exports=function(e){function t(){return this.value}function n(){throw this.reason}e.prototype.return=e.prototype.thenReturn=function(n){return n instanceof e&&n.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:n},void 0)},e.prototype.throw=e.prototype.thenThrow=function(e){return this._then(n,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:e},void 0);var t=arguments[1],r=function(){throw t};return this.caught(e,r)},e.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof e&&n.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:n},void 0);var r=arguments[1];r instanceof e&&r.suppressUnhandledRejections();var i=function(){return r};return this.caught(n,i)}}},{}],11:[function(e,t,n){"use strict";t.exports=function(e,t){var n=e.reduce,r=e.all;function i(){return r(this)}e.prototype.each=function(e){return n(this,e,t,0)._then(i,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return n(this,e,t,t)},e.each=function(e,r){return n(e,r,t,0)._then(i,void 0,void 0,e,void 0)},e.mapSeries=function(e,r){return n(e,r,t,t)}}},{}],12:[function(e,t,n){"use strict";var r,i,o=e("./es5"),s=o.freeze,a=e("./util"),u=a.inherits,c=a.notEnumerableProp;function l(e,t){function n(r){if(!(this instanceof n))return new n(r);c(this,"message","string"==typeof r?r:t),c(this,"name",e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return u(n,Error),n}var f=l("Warning","warning"),h=l("CancellationError","cancellation error"),p=l("TimeoutError","timeout error"),d=l("AggregateError","aggregate error");try{r=TypeError,i=RangeError}catch(e){r=l("TypeError","type error"),i=l("RangeError","range error")}for(var v="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),y=0;y<v.length;++y)"function"==typeof Array.prototype[v[y]]&&(d.prototype[v[y]]=Array.prototype[v[y]]);o.defineProperty(d.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),d.prototype.isOperational=!0;var _=0;function m(e){if(!(this instanceof m))return new m(e);c(this,"name","OperationalError"),c(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(c(this,"message",e.message),c(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}d.prototype.toString=function(){var e=Array(4*_+1).join(" "),t="\n"+e+"AggregateError of:\n";_++,e=Array(4*_+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=e+i[o];t+=(r=i.join("\n"))+"\n"}return _--,t},u(m,Error);var g=Error.__BluebirdErrorTypes__;g||(g=s({CancellationError:h,TimeoutError:p,OperationalError:m,RejectionError:m,AggregateError:d}),o.defineProperty(Error,"__BluebirdErrorTypes__",{value:g,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:r,RangeError:i,CancellationError:g.CancellationError,OperationalError:g.OperationalError,TimeoutError:g.TimeoutError,AggregateError:g.AggregateError,Warning:f}},{"./es5":13,"./util":36}],13:[function(e,t,n){var r=function(){"use strict";return void 0===this}();if(r)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(e,t){var n=Object.getOwnPropertyDescriptor(e,t);return!(n&&!n.writable&&!n.set)}};else{var i={}.hasOwnProperty,o={}.toString,s={}.constructor.prototype,a=function(e){var t=[];for(var n in e)i.call(e,n)&&t.push(n);return t};t.exports={isArray:function(e){try{return"[object Array]"===o.call(e)}catch(e){return!1}},keys:a,names:a,defineProperty:function(e,t,n){return e[t]=n.value,e},getDescriptor:function(e,t){return{value:e[t]}},freeze:function(e){return e},getPrototypeOf:function(e){try{return Object(e).constructor.prototype}catch(e){return s}},isES5:r,propertyIsWritable:function(){return!0}}}},{}],14:[function(e,t,n){"use strict";t.exports=function(e,t){var n=e.map;e.prototype.filter=function(e,r){return n(this,e,r,t)},e.filter=function(e,r,i){return n(e,r,i,t)}}},{}],15:[function(e,t,n){"use strict";t.exports=function(t,n,r){var i=e("./util"),o=t.CancellationError,s=i.errorObj,a=e("./catch_filter")(r);function u(e,t,n){this.promise=e,this.type=t,this.handler=n,this.called=!1,this.cancelPromise=null}function c(e){this.finallyHandler=e}function l(e,t){return null!=e.cancelPromise&&(arguments.length>1?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0)}function f(){return p.call(this,this.promise._target()._settledValue())}function h(e){if(!l(this,e))return s.e=e,s}function p(e){var i=this.promise,a=this.handler;if(!this.called){this.called=!0;var u=this.isFinallyHandler()?a.call(i._boundValue()):a.call(i._boundValue(),e);if(u===r)return u;if(void 0!==u){i._setReturnedNonUndefined();var p=n(u,i);if(p instanceof t){if(null!=this.cancelPromise){if(p._isCancelled()){var d=new o("late cancellation observer");return i._attachExtraTrace(d),s.e=d,s}p.isPending()&&p._attachCancellationCallback(new c(this))}return p._then(f,h,void 0,this,void 0)}}}return i.isRejected()?(l(this),s.e=e,s):(l(this),e)}return u.prototype.isFinallyHandler=function(){return 0===this.type},c.prototype._resultCancelled=function(){l(this.finallyHandler)},t.prototype._passThrough=function(e,t,n,r){return"function"!=typeof e?this.then():this._then(n,r,void 0,new u(this,t,e),void 0)},t.prototype.lastly=t.prototype.finally=function(e){return this._passThrough(e,0,p,p)},t.prototype.tap=function(e){return this._passThrough(e,1,p)},t.prototype.tapCatch=function(e){var n=arguments.length;if(1===n)return this._passThrough(e,1,void 0,p);var r,o=new Array(n-1),s=0;for(r=0;r<n-1;++r){var u=arguments[r];if(!i.isObject(u))return t.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+i.classString(u)));o[s++]=u}o.length=s;var c=arguments[r];return this._passThrough(a(o,c,this),1,void 0,p)},u}},{"./catch_filter":7,"./util":36}],16:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,s){var a=e("./errors").TypeError,u=e("./util"),c=u.errorObj,l=u.tryCatch,f=[];function h(e,n,i,o){if(s.cancellation()){var a=new t(r),u=this._finallyPromise=new t(r);this._promise=a.lastly((function(){return u})),a._captureStackTrace(),a._setOnCancel(this)}else(this._promise=new t(r))._captureStackTrace();this._stack=o,this._generatorFunction=e,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof i?[i].concat(f):f,this._yieldedPromise=null,this._cancellationPhase=!1}u.inherits(h,o),h.prototype._isResolved=function(){return null===this._promise},h.prototype._cleanup=function(){this._promise=this._generator=null,s.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},h.prototype._promiseCancelled=function(){if(!this._isResolved()){var e;if(void 0!==this._generator.return)this._promise._pushContext(),e=l(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var n=new t.CancellationError("generator .return() sentinel");t.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),e=l(this._generator.throw).call(this._generator,n),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},h.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=l(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},h.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=l(this._generator.throw).call(this._generator,e);this._promise._popContext(),this._continue(t)},h.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},h.prototype.promise=function(){return this._promise},h.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},h.prototype._continue=function(e){var n=this._promise;if(e===c)return this._cleanup(),this._cancellationPhase?n.cancel():n._rejectCallback(e.e,!1);var r=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?n.cancel():n._resolveCallback(r);var o=i(r,this._promise);if(o instanceof t||null!==(o=function(e,n,r){for(var o=0;o<n.length;++o){r._pushContext();var s=l(n[o])(e);if(r._popContext(),s===c){r._pushContext();var a=t.reject(c.e);return r._popContext(),a}var u=i(s,r);if(u instanceof t)return u}return null}(o,this._yieldHandlers,this._promise))){var s=(o=o._target())._bitField;0==(50397184&s)?(this._yieldedPromise=o,o._proxy(this,null)):0!=(33554432&s)?t._async.invoke(this._promiseFulfilled,this,o._value()):0!=(16777216&s)?t._async.invoke(this._promiseRejected,this,o._reason()):this._promiseCancelled()}else this._promiseRejected(new a("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(r))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},t.coroutine=function(e,t){if("function"!=typeof e)throw new a("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=Object(t).yieldHandler,r=h,i=(new Error).stack;return function(){var t=e.apply(this,arguments),o=new r(void 0,void 0,n,i),s=o.promise();return o._generator=t,o._promiseFulfilled(void 0),s}},t.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new a("expecting a function but got "+u.classString(e));f.push(e)},t.spawn=function(e){if(s.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof e)return n("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=new h(e,this),i=r.promise();return r._run(t.spawn),i}}},{"./errors":12,"./util":36}],17:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o){var s=e("./util");s.canEvaluate,s.tryCatch,s.errorObj,t.join=function(){var e,t=arguments.length-1;t>0&&"function"==typeof arguments[t]&&(e=arguments[t]);var r=[].slice.call(arguments);e&&r.pop();var i=new n(r).promise();return void 0!==e?i.spread(e):i}}},{"./util":36}],18:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,s){var a=e("./util"),u=a.tryCatch,c=a.errorObj,l=t._async;function f(e,n,r,i){this.constructor$(e),this._promise._captureStackTrace();var s=t._getContext();if(this._callback=a.contextBind(s,n),this._preservedValues=i===o?new Array(this.length()):null,this._limit=r,this._inFlight=0,this._queue=[],l.invoke(this._asyncInit,this,void 0),a.isArray(e))for(var u=0;u<e.length;++u){var c=e[u];c instanceof t&&c.suppressUnhandledRejections()}}function h(e,n,i,o){if("function"!=typeof n)return r("expecting a function but got "+a.classString(n));var s=0;if(void 0!==i){if("object"!=typeof i||null===i)return t.reject(new TypeError("options argument must be an object but it is "+a.classString(i)));if("number"!=typeof i.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+a.classString(i.concurrency)));s=i.concurrency}return new f(e,n,s="number"==typeof s&&isFinite(s)&&s>=1?s:0,o).promise()}a.inherits(f,n),f.prototype._asyncInit=function(){this._init$(void 0,-2)},f.prototype._init=function(){},f.prototype._promiseFulfilled=function(e,n){var r=this._values,o=this.length(),a=this._preservedValues,l=this._limit;if(n<0){if(r[n=-1*n-1]=e,l>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(l>=1&&this._inFlight>=l)return r[n]=e,this._queue.push(n),!1;null!==a&&(a[n]=e);var f=this._promise,h=this._callback,p=f._boundValue();f._pushContext();var d=u(h).call(p,e,n,o),v=f._popContext();if(s.checkForgottenReturns(d,v,null!==a?"Promise.filter":"Promise.map",f),d===c)return this._reject(d.e),!0;var y=i(d,this._promise);if(y instanceof t){var _=(y=y._target())._bitField;if(0==(50397184&_))return l>=1&&this._inFlight++,r[n]=y,y._proxy(this,-1*(n+1)),!1;if(0==(33554432&_))return 0!=(16777216&_)?(this._reject(y._reason()),!0):(this._cancel(),!0);d=y._value()}r[n]=d}return++this._totalResolved>=o&&(null!==a?this._filter(r,a):this._resolve(r),!0)},f.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,n=this._values;e.length>0&&this._inFlight<t;){if(this._isResolved())return;var r=e.pop();this._promiseFulfilled(n[r],r)}},f.prototype._filter=function(e,t){for(var n=t.length,r=new Array(n),i=0,o=0;o<n;++o)e[o]&&(r[i++]=t[o]);r.length=i,this._resolve(r)},f.prototype.preservedValues=function(){return this._preservedValues},t.prototype.map=function(e,t){return h(this,e,t,null)},t.map=function(e,t,n,r){return h(e,t,n,r)}}},{"./util":36}],19:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o){var s=e("./util"),a=s.tryCatch;t.method=function(e){if("function"!=typeof e)throw new t.TypeError("expecting a function but got "+s.classString(e));return function(){var r=new t(n);r._captureStackTrace(),r._pushContext();var i=a(e).apply(this,arguments),s=r._popContext();return o.checkForgottenReturns(i,s,"Promise.method",r),r._resolveFromSyncValue(i),r}},t.attempt=t.try=function(e){if("function"!=typeof e)return i("expecting a function but got "+s.classString(e));var r,u=new t(n);if(u._captureStackTrace(),u._pushContext(),arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var c=arguments[1],l=arguments[2];r=s.isArray(c)?a(e).apply(l,c):a(e).call(l,c)}else r=a(e)();var f=u._popContext();return o.checkForgottenReturns(r,f,"Promise.try",u),u._resolveFromSyncValue(r),u},t.prototype._resolveFromSyncValue=function(e){e===s.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":36}],20:[function(e,t,n){"use strict";var r=e("./util"),i=r.maybeWrapAsError,o=e("./errors").OperationalError,s=e("./es5"),a=/^(?:name|message|stack|cause)$/;function u(e){var t;if(function(e){return e instanceof Error&&s.getPrototypeOf(e)===Error.prototype}(e)){(t=new o(e)).name=e.name,t.message=e.message,t.stack=e.stack;for(var n=s.keys(e),i=0;i<n.length;++i){var u=n[i];a.test(u)||(t[u]=e[u])}return t}return r.markAsOriginatingFromRejection(e),e}t.exports=function(e,t){return function(n,r){if(null!==e){if(n){var o=u(i(n));e._attachExtraTrace(o),e._reject(o)}else if(t){var s=[].slice.call(arguments,1);e._fulfill(s)}else e._fulfill(r);e=null}}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(e,t,n){"use strict";t.exports=function(t){var n=e("./util"),r=t._async,i=n.tryCatch,o=n.errorObj;function s(e,t){if(!n.isArray(e))return a.call(this,e,t);var s=i(t).apply(this._boundValue(),[null].concat(e));s===o&&r.throwLater(s.e)}function a(e,t){var n=this._boundValue(),s=void 0===e?i(t).call(n,null):i(t).call(n,null,e);s===o&&r.throwLater(s.e)}function u(e,t){if(!e){var n=new Error(e+"");n.cause=e,e=n}var s=i(t).call(this._boundValue(),e);s===o&&r.throwLater(s.e)}t.prototype.asCallback=t.prototype.nodeify=function(e,t){if("function"==typeof e){var n=a;void 0!==t&&Object(t).spread&&(n=s),this._then(n,u,void 0,this,e)}return this}}},{"./util":36}],22:[function(e,n,r){"use strict";n.exports=function(){var r=function(){return new m("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},i=function(){return new A.PromiseInspection(this._target())},o=function(e){return A.reject(new m(e))};function s(){}var a={},u=e("./util");u.setReflectHandler(i);var c=function(){var e=t.domain;return void 0===e?null:e},l=function(){return{domain:c(),async:null}},f=u.isNode&&u.nodeSupportsAsyncResource?e("async_hooks").AsyncResource:null,h=function(){return{domain:c(),async:new f("Bluebird::Promise")}},p=u.isNode?l:function(){return null};u.notEnumerableProp(A,"_getContext",p);var d=e("./es5"),v=e("./async"),y=new v;d.defineProperty(A,"_async",{value:y});var _=e("./errors"),m=A.TypeError=_.TypeError;A.RangeError=_.RangeError;var g=A.CancellationError=_.CancellationError;A.TimeoutError=_.TimeoutError,A.OperationalError=_.OperationalError,A.RejectionError=_.OperationalError,A.AggregateError=_.AggregateError;var b=function(){},k={},w={},j=e("./thenables")(A,b),C=e("./promise_array")(A,b,j,o,s),E=e("./context")(A),T=E.create,S=e("./debuggability")(A,E,(function(){p=h,u.notEnumerableProp(A,"_getContext",h)}),(function(){p=l,u.notEnumerableProp(A,"_getContext",l)})),P=(S.CapturedTrace,e("./finally")(A,j,w)),F=e("./catch_filter")(w),x=e("./nodeback"),O=u.errorObj,R=u.tryCatch;function A(e){e!==b&&function(e,t){if(null==e||e.constructor!==A)throw new m("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof t)throw new m("expecting a function but got "+u.classString(t))}(this,e),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(e),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function I(e){this.promise._resolveCallback(e)}function U(e){this.promise._rejectCallback(e,!1)}function D(e){var t=new A(b);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}return A.prototype.toString=function(){return"[object Promise]"},A.prototype.caught=A.prototype.catch=function(e){var t=arguments.length;if(t>1){var n,r=new Array(t-1),i=0;for(n=0;n<t-1;++n){var s=arguments[n];if(!u.isObject(s))return o("Catch statement predicate: expecting an object but got "+u.classString(s));r[i++]=s}if(r.length=i,"function"!=typeof(e=arguments[n]))throw new m("The last argument to .catch() must be a function, got "+u.toString(e));return this.then(void 0,F(r,e,this))}return this.then(void 0,e)},A.prototype.reflect=function(){return this._then(i,i,void 0,this,void 0)},A.prototype.then=function(e,t){if(S.warnings()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var n=".then() only accepts functions but was passed: "+u.classString(e);arguments.length>1&&(n+=", "+u.classString(t)),this._warn(n)}return this._then(e,t,void 0,void 0,void 0)},A.prototype.done=function(e,t){this._then(e,t,void 0,void 0,void 0)._setIsFinal()},A.prototype.spread=function(e){return"function"!=typeof e?o("expecting a function but got "+u.classString(e)):this.all()._then(e,void 0,void 0,k,void 0)},A.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},A.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new C(this).promise()},A.prototype.error=function(e){return this.caught(u.originatesFromRejection,e)},A.getNewLibraryCopy=n.exports,A.is=function(e){return e instanceof A},A.fromNode=A.fromCallback=function(e){var t=new A(b);t._captureStackTrace();var n=arguments.length>1&&!!Object(arguments[1]).multiArgs,r=R(e)(x(t,n));return r===O&&t._rejectCallback(r.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},A.all=function(e){return new C(e).promise()},A.cast=function(e){var t=j(e);return t instanceof A||((t=new A(b))._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},A.resolve=A.fulfilled=A.cast,A.reject=A.rejected=function(e){var t=new A(b);return t._captureStackTrace(),t._rejectCallback(e,!0),t},A.setScheduler=function(e){if("function"!=typeof e)throw new m("expecting a function but got "+u.classString(e));return y.setScheduler(e)},A.prototype._then=function(e,t,n,r,i){var o=void 0!==i,s=o?i:new A(b),a=this._target(),c=a._bitField;o||(s._propagateFrom(this,3),s._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(r=0!=(50397184&c)?this._boundValue():a===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,s));var l=p();if(0!=(50397184&c)){var f,h,d=a._settlePromiseCtx;0!=(33554432&c)?(h=a._rejectionHandler0,f=e):0!=(16777216&c)?(h=a._fulfillmentHandler0,f=t,a._unsetRejectionIsUnhandled()):(d=a._settlePromiseLateCancellationObserver,h=new g("late cancellation observer"),a._attachExtraTrace(h),f=t),y.invoke(d,a,{handler:u.contextBind(l,f),promise:s,receiver:r,value:h})}else a._addCallbacks(e,t,s,r,l);return s},A.prototype._length=function(){return 65535&this._bitField},A.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},A.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},A.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},A.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},A.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},A.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},A.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},A.prototype._isFinal=function(){return(4194304&this._bitField)>0},A.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},A.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},A.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},A.prototype._setAsyncGuaranteed=function(){if(!y.hasCustomScheduler()){var e=this._bitField;this._bitField=e|(536870912&e)>>2^134217728}},A.prototype._setNoAsyncGuarantee=function(){this._bitField=-134217729&(536870912|this._bitField)},A.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==a)return void 0===t&&this._isBound()?this._boundValue():t},A.prototype._promiseAt=function(e){return this[4*e-4+2]},A.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},A.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},A.prototype._boundValue=function(){},A.prototype._migrateCallback0=function(e){e._bitField;var t=e._fulfillmentHandler0,n=e._rejectionHandler0,r=e._promise0,i=e._receiverAt(0);void 0===i&&(i=a),this._addCallbacks(t,n,r,i,null)},A.prototype._migrateCallbackAt=function(e,t){var n=e._fulfillmentHandlerAt(t),r=e._rejectionHandlerAt(t),i=e._promiseAt(t),o=e._receiverAt(t);void 0===o&&(o=a),this._addCallbacks(n,r,i,o,null)},A.prototype._addCallbacks=function(e,t,n,r,i){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=r,"function"==typeof e&&(this._fulfillmentHandler0=u.contextBind(i,e)),"function"==typeof t&&(this._rejectionHandler0=u.contextBind(i,t));else{var s=4*o-4;this[s+2]=n,this[s+3]=r,"function"==typeof e&&(this[s+0]=u.contextBind(i,e)),"function"==typeof t&&(this[s+1]=u.contextBind(i,t))}return this._setLength(o+1),o},A.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},A.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(r(),!1);var n=j(e,this);if(!(n instanceof A))return this._fulfill(e);t&&this._propagateFrom(n,2);var i=n._target();if(i!==this){var o=i._bitField;if(0==(50397184&o)){var s=this._length();s>0&&i._migrateCallback0(this);for(var a=1;a<s;++a)i._migrateCallbackAt(this,a);this._setFollowing(),this._setLength(0),this._setFollowee(n)}else if(0!=(33554432&o))this._fulfill(i._value());else if(0!=(16777216&o))this._reject(i._reason());else{var u=new g("late cancellation observer");i._attachExtraTrace(u),this._reject(u)}}else this._reject(r())}},A.prototype._rejectCallback=function(e,t,n){var r=u.ensureErrorObject(e),i=r===e;if(!i&&!n&&S.warnings()){var o="a promise was rejected with a non-error: "+u.classString(e);this._warn(o,!0)}this._attachExtraTrace(r,!!t&&i),this._reject(e)},A.prototype._resolveFromExecutor=function(e){if(e!==b){var t=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(e,(function(e){t._resolveCallback(e)}),(function(e){t._rejectCallback(e,n)}));n=!1,this._popContext(),void 0!==r&&t._rejectCallback(r,!0)}},A.prototype._settlePromiseFromHandler=function(e,t,n,r){var i=r._bitField;if(0==(65536&i)){var o;r._pushContext(),t===k?n&&"number"==typeof n.length?o=R(e).apply(this._boundValue(),n):(o=O).e=new m("cannot .spread() a non-array: "+u.classString(n)):o=R(e).call(t,n);var s=r._popContext();0==(65536&(i=r._bitField))&&(o===w?r._reject(n):o===O?r._rejectCallback(o.e,!1):(S.checkForgottenReturns(o,s,"",r,this),r._resolveCallback(o)))}},A.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},A.prototype._followee=function(){return this._rejectionHandler0},A.prototype._setFollowee=function(e){this._rejectionHandler0=e},A.prototype._settlePromise=function(e,t,n,r){var o=e instanceof A,a=this._bitField,u=0!=(134217728&a);0!=(65536&a)?(o&&e._invokeInternalOnCancel(),n instanceof P&&n.isFinallyHandler()?(n.cancelPromise=e,R(t).call(n,r)===O&&e._reject(O.e)):t===i?e._fulfill(i.call(n)):n instanceof s?n._promiseCancelled(e):o||e instanceof C?e._cancel():n.cancel()):"function"==typeof t?o?(u&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,n,r,e)):t.call(n,r,e):n instanceof s?n._isResolved()||(0!=(33554432&a)?n._promiseFulfilled(r,e):n._promiseRejected(r,e)):o&&(u&&e._setAsyncGuaranteed(),0!=(33554432&a)?e._fulfill(r):e._reject(r))},A.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,n=e.promise,r=e.receiver,i=e.value;"function"==typeof t?n instanceof A?this._settlePromiseFromHandler(t,r,i,n):t.call(r,i,n):n instanceof A&&n._reject(i)},A.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},A.prototype._settlePromise0=function(e,t,n){var r=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,e,i,t)},A.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},A.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var n=r();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=e,(65535&t)>0&&(0!=(134217728&t)?this._settlePromises():y.settlePromises(this),this._dereferenceTrace())}},A.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=e,this._isFinal())return y.fatalError(e,u.isNode);(65535&t)>0?y.settlePromises(this):this._ensurePossibleRejectionHandled()}},A.prototype._fulfillPromises=function(e,t){for(var n=1;n<e;n++){var r=this._fulfillmentHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},A.prototype._rejectPromises=function(e,t){for(var n=1;n<e;n++){var r=this._rejectionHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},A.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(t>0){if(0!=(16842752&e)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,e),this._rejectPromises(t,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,e),this._fulfillPromises(t,r)}this._setLength(0)}this._clearCancellationData()},A.prototype._settledValue=function(){var e=this._bitField;return 0!=(33554432&e)?this._rejectionHandler0:0!=(16777216&e)?this._fulfillmentHandler0:void 0},"undefined"!=typeof Symbol&&Symbol.toStringTag&&d.defineProperty(A.prototype,Symbol.toStringTag,{get:function(){return"Object"}}),A.defer=A.pending=function(){return S.deprecated("Promise.defer","new Promise"),{promise:new A(b),resolve:I,reject:U}},u.notEnumerableProp(A,"_makeSelfResolutionError",r),e("./method")(A,b,j,o,S),e("./bind")(A,b,j,S),e("./cancel")(A,C,o,S),e("./direct_resolve")(A),e("./synchronous_inspection")(A),e("./join")(A,C,j,b,y),A.Promise=A,A.version="3.7.2",e("./call_get.js")(A),e("./generators.js")(A,o,b,j,s,S),e("./map.js")(A,C,o,j,b,S),e("./nodeify.js")(A),e("./promisify.js")(A,b),e("./props.js")(A,C,j,o),e("./race.js")(A,b,j,o),e("./reduce.js")(A,C,o,j,b,S),e("./settle.js")(A,C,S),e("./some.js")(A,C,o),e("./timers.js")(A,b,S),e("./using.js")(A,o,j,T,b,S),e("./any.js")(A),e("./each.js")(A,b),e("./filter.js")(A,b),u.toFastProperties(A),u.toFastProperties(A.prototype),D({a:1}),D({b:2}),D({c:3}),D(1),D((function(){})),D(void 0),D(!1),D(new A(b)),S.setBounds(v.firstLineError,u.lastLineError),A}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36,async_hooks:void 0}],23:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o){var s=e("./util");function a(e){var r=this._promise=new t(n);e instanceof t&&(r._propagateFrom(e,3),e.suppressUnhandledRejections()),r._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}return s.isArray,s.inherits(a,o),a.prototype.length=function(){return this._length},a.prototype.promise=function(){return this._promise},a.prototype._init=function e(n,o){var a=r(this._values,this._promise);if(a instanceof t){var u=(a=a._target())._bitField;if(this._values=a,0==(50397184&u))return this._promise._setAsyncGuaranteed(),a._then(e,this._reject,void 0,this,o);if(0==(33554432&u))return 0!=(16777216&u)?this._reject(a._reason()):this._cancel();a=a._value()}if(null!==(a=s.asArray(a)))0!==a.length?this._iterate(a):-5===o?this._resolveEmptyArray():this._resolve(function(e){switch(e){case-2:return[];case-3:return{};case-6:return new Map}}(o));else{var c=i("expecting an array or an iterable object but got "+s.classString(a)).reason();this._promise._rejectCallback(c,!1)}},a.prototype._iterate=function(e){var n=this.getActualLength(e.length);this._length=n,this._values=this.shouldCopyValues()?new Array(n):this._values;for(var i=this._promise,o=!1,s=null,a=0;a<n;++a){var u=r(e[a],i);s=u instanceof t?(u=u._target())._bitField:null,o?null!==s&&u.suppressUnhandledRejections():null!==s?0==(50397184&s)?(u._proxy(this,a),this._values[a]=u):o=0!=(33554432&s)?this._promiseFulfilled(u._value(),a):0!=(16777216&s)?this._promiseRejected(u._reason(),a):this._promiseCancelled(a):o=this._promiseFulfilled(u,a)}o||i._setAsyncGuaranteed()},a.prototype._isResolved=function(){return null===this._values},a.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},a.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},a.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},a.prototype._promiseFulfilled=function(e,t){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},a.prototype._promiseCancelled=function(){return this._cancel(),!0},a.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},a.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof t)e.cancel();else for(var n=0;n<e.length;++n)e[n]instanceof t&&e[n].cancel()}},a.prototype.shouldCopyValues=function(){return!0},a.prototype.getActualLength=function(e){return e},a}},{"./util":36}],24:[function(e,t,n){"use strict";t.exports=function(t,n){var r={},i=e("./util"),o=e("./nodeback"),s=i.withAppended,a=i.maybeWrapAsError,u=i.canEvaluate,c=e("./errors").TypeError,l={__isPromisified__:!0},f=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),h=function(e){return i.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e};function p(e){return!f.test(e)}function d(e){try{return!0===e.__isPromisified__}catch(e){return!1}}function v(e,t,n){var r=i.getDataPropertyOrDefault(e,t+n,l);return!!r&&d(r)}function y(e,t,n,r){for(var o=i.inheritedDataKeys(e),s=[],a=0;a<o.length;++a){var u=o[a],l=e[u],f=r===h||h(u);"function"!=typeof l||d(l)||v(e,u,t)||!r(u,l,e,f)||s.push(u,l)}return function(e,t,n){for(var r=0;r<e.length;r+=2){var i=e[r];if(n.test(i))for(var o=i.replace(n,""),s=0;s<e.length;s+=2)if(e[s]===o)throw new c("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t))}}(s,t,n),s}var _=u?void 0:function(e,u,c,l,f,h){var p=function(){return this}(),d=e;function v(){var i=u;u===r&&(i=this);var c=new t(n);c._captureStackTrace();var l="string"==typeof d&&this!==p?this[d]:e,f=o(c,h);try{l.apply(i,s(arguments,f))}catch(e){c._rejectCallback(a(e),!0,!0)}return c._isFateSealed()||c._setAsyncGuaranteed(),c}return"string"==typeof d&&(e=l),i.notEnumerableProp(v,"__isPromisified__",!0),v};function m(e,t,n,o,s){for(var a=new RegExp(t.replace(/([$])/,"\\$")+"$"),u=y(e,t,a,n),c=0,l=u.length;c<l;c+=2){var f=u[c],h=u[c+1],p=f+t;if(o===_)e[p]=_(f,r,f,h,t,s);else{var d=o(h,(function(){return _(f,r,f,h,t,s)}));i.notEnumerableProp(d,"__isPromisified__",!0),e[p]=d}}return i.toFastProperties(e),e}t.promisify=function(e,t){if("function"!=typeof e)throw new c("expecting a function but got "+i.classString(e));if(d(e))return e;var n=function(e,t,n){return _(e,t,void 0,e,null,n)}(e,void 0===(t=Object(t)).context?r:t.context,!!t.multiArgs);return i.copyDescriptors(e,n,p),n},t.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=typeof e)throw new c("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var n=!!(t=Object(t)).multiArgs,r=t.suffix;"string"!=typeof r&&(r="Async");var o=t.filter;"function"!=typeof o&&(o=h);var s=t.promisifier;if("function"!=typeof s&&(s=_),!i.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var a=i.inheritedDataKeys(e),u=0;u<a.length;++u){var l=e[a[u]];"constructor"!==a[u]&&i.isClass(l)&&(m(l.prototype,r,o,s,n),m(l,r,o,s,n))}return m(e,r,o,s,n)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){var o,s=e("./util"),a=s.isObject,u=e("./es5");"function"==typeof Map&&(o=Map);var c=function(){var e=0,t=0;function n(n,r){this[e]=n,this[e+t]=r,e++}return function(r){t=r.size,e=0;var i=new Array(2*r.size);return r.forEach(n,i),i}}();function l(e){var t,n=!1;if(void 0!==o&&e instanceof o)t=c(e),n=!0;else{var r=u.keys(e),i=r.length;t=new Array(2*i);for(var s=0;s<i;++s){var a=r[s];t[s]=e[a],t[s+i]=a}}this.constructor$(t),this._isMap=n,this._init$(void 0,n?-6:-3)}function f(e){var n,o=r(e);return a(o)?(n=o instanceof t?o._then(t.props,void 0,void 0,void 0,void 0):new l(o).promise(),o instanceof t&&n._propagateFrom(o,2),n):i("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}s.inherits(l,n),l.prototype._init=function(){},l.prototype._promiseFulfilled=function(e,t){if(this._values[t]=e,++this._totalResolved>=this._length){var n;if(this._isMap)n=function(e){for(var t=new o,n=e.length/2|0,r=0;r<n;++r){var i=e[n+r],s=e[r];t.set(i,s)}return t}(this._values);else{n={};for(var r=this.length(),i=0,s=this.length();i<s;++i)n[this._values[i+r]]=this._values[i]}return this._resolve(n),!0}return!1},l.prototype.shouldCopyValues=function(){return!1},l.prototype.getActualLength=function(e){return e>>1},t.prototype.props=function(){return f(this)},t.props=function(e){return f(e)}}},{"./es5":13,"./util":36}],26:[function(e,t,n){"use strict";function r(e){this._capacity=e,this._length=0,this._front=0}r.prototype._willBeOverCapacity=function(e){return this._capacity<e},r.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1),this[this._front+t&this._capacity-1]=e,this._length=t+1},r.prototype.push=function(e,t,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(e),this._pushOne(t),void this._pushOne(n);var i=this._front+r-3;this._checkCapacity(r);var o=this._capacity-1;this[i+0&o]=e,this[i+1&o]=t,this[i+2&o]=n,this._length=r},r.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},r.prototype.length=function(){return this._length},r.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},r.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e,function(e,t,n,r,i){for(var o=0;o<i;++o)n[o+r]=e[o+t],e[o+t]=void 0}(this,0,this,t,this._front+this._length&t-1)},t.exports=r},{}],27:[function(e,t,n){"use strict";t.exports=function(t,n,r,i){var o=e("./util");function s(e,a){var u,c=r(e);if(c instanceof t)return(u=c).then((function(e){return s(e,u)}));if(null===(e=o.asArray(e)))return i("expecting an array or an iterable object but got "+o.classString(e));var l=new t(n);void 0!==a&&l._propagateFrom(a,3);for(var f=l._fulfill,h=l._reject,p=0,d=e.length;p<d;++p){var v=e[p];(void 0!==v||p in e)&&t.cast(v)._then(f,h,void 0,l,null)}return l}t.race=function(e){return s(e,void 0)},t.prototype.race=function(){return s(this,void 0)}}},{"./util":36}],28:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,s){var a=e("./util"),u=a.tryCatch;function c(e,n,r,i){this.constructor$(e);var s=t._getContext();this._fn=a.contextBind(s,n),void 0!==r&&(r=t.resolve(r))._attachCancellationCallback(this),this._initialValue=r,this._currentCancellable=null,this._eachValues=i===o?Array(this._length):0===i?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function l(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function f(e,t,n,i){return"function"!=typeof t?r("expecting a function but got "+a.classString(t)):new c(e,t,n,i).promise()}function h(e){this.accum=e,this.array._gotAccum(e);var n=i(this.value,this.array._promise);return n instanceof t?(this.array._currentCancellable=n,n._then(p,void 0,void 0,this,void 0)):p.call(this,n)}function p(e){var n,r=this.array,i=r._promise,o=u(r._fn);i._pushContext(),(n=void 0!==r._eachValues?o.call(i._boundValue(),e,this.index,this.length):o.call(i._boundValue(),this.accum,e,this.index,this.length))instanceof t&&(r._currentCancellable=n);var a=i._popContext();return s.checkForgottenReturns(n,a,void 0!==r._eachValues?"Promise.each":"Promise.reduce",i),n}a.inherits(c,n),c.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==o&&this._eachValues.push(e)},c.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},c.prototype._init=function(){},c.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},c.prototype.shouldCopyValues=function(){return!1},c.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},c.prototype._resultCancelled=function(e){if(e===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel())},c.prototype._iterate=function(e){var n,r;this._values=e;var i=e.length;void 0!==this._initialValue?(n=this._initialValue,r=0):(n=t.resolve(e[0]),r=1),this._currentCancellable=n;for(var o=r;o<i;++o){var s=e[o];s instanceof t&&s.suppressUnhandledRejections()}if(!n.isRejected())for(;r<i;++r){var a={accum:null,value:e[r],index:r,length:i,array:this};n=n._then(h,void 0,void 0,a,void 0),0==(127&r)&&n._setNoAsyncGuarantee()}void 0!==this._eachValues&&(n=n._then(this._eachComplete,void 0,void 0,this,void 0)),n._then(l,l,void 0,n,this)},t.prototype.reduce=function(e,t){return f(this,e,t,null)},t.reduce=function(e,t,n,r){return f(e,t,n,r)}}},{"./util":36}],29:[function(e,i,o){"use strict";var s,a,u,c,l,f=e("./util"),h=f.getNativePromise();if(f.isNode&&"undefined"==typeof MutationObserver){var p=n.setImmediate,d=t.nextTick;s=f.isRecentNode?function(e){p.call(n,e)}:function(e){d.call(t,e)}}else if("function"==typeof h&&"function"==typeof h.resolve){var v=h.resolve();s=function(e){v.then(e)}}else s="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)||!("classList"in document.documentElement)?void 0!==r?function(e){r(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}:(a=document.createElement("div"),u={attributes:!0},c=!1,l=document.createElement("div"),new MutationObserver((function(){a.classList.toggle("foo"),c=!1})).observe(l,u),function(e){var t=new MutationObserver((function(){t.disconnect(),e()}));t.observe(a,u),c||(c=!0,l.classList.toggle("foo"))});i.exports=s},{"./util":36}],30:[function(e,t,n){"use strict";t.exports=function(t,n,r){var i=t.PromiseInspection;function o(e){this.constructor$(e)}e("./util").inherits(o,n),o.prototype._promiseResolved=function(e,t){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},o.prototype._promiseFulfilled=function(e,t){var n=new i;return n._bitField=33554432,n._settledValueField=e,this._promiseResolved(t,n)},o.prototype._promiseRejected=function(e,t){var n=new i;return n._bitField=16777216,n._settledValueField=e,this._promiseResolved(t,n)},t.settle=function(e){return r.deprecated(".settle()",".reflect()"),new o(e).promise()},t.allSettled=function(e){return new o(e).promise()},t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(e,t,n){"use strict";t.exports=function(t,n,r){var i=e("./util"),o=e("./errors").RangeError,s=e("./errors").AggregateError,a=i.isArray,u={};function c(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function l(e,t){if((0|t)!==t||t<0)return r("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var n=new c(e),i=n.promise();return n.setHowMany(t),n.init(),i}i.inherits(c,n),c.prototype._init=function(){if(this._initialized)if(0!==this._howMany){this._init$(void 0,-5);var e=a(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}else this._resolve([])},c.prototype.init=function(){this._initialized=!0,this._init()},c.prototype.setUnwrap=function(){this._unwrap=!0},c.prototype.howMany=function(){return this._howMany},c.prototype.setHowMany=function(e){this._howMany=e},c.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},c.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},c.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(u),this._checkOutcome())},c.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new s,t=this.length();t<this._values.length;++t)this._values[t]!==u&&e.push(this._values[t]);return e.length>0?this._reject(e):this._cancel(),!0}return!1},c.prototype._fulfilled=function(){return this._totalResolved},c.prototype._rejected=function(){return this._values.length-this.length()},c.prototype._addRejected=function(e){this._values.push(e)},c.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},c.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},c.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new o(t)},c.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},t.some=function(e,t){return l(e,t)},t.prototype.some=function(e){return l(this,e)},t._SomePromiseArray=c}},{"./errors":12,"./util":36}],32:[function(e,t,n){"use strict";t.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var n=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},s=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},a=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return s.call(this._target())},e.prototype.isRejected=function(){return o.call(this._target())},e.prototype.isFulfilled=function(){return i.call(this._target())},e.prototype.isResolved=function(){return a.call(this._target())},e.prototype.value=function(){return n.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),r.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],33:[function(e,t,n){"use strict";t.exports=function(t,n){var r=e("./util"),i=r.errorObj,o=r.isObject,s={}.hasOwnProperty;return function(e,a){if(o(e)){if(e instanceof t)return e;var u=function(e){try{return function(e){return e.then}(e)}catch(e){return i.e=e,i}}(e);if(u===i){a&&a._pushContext();var c=t.reject(u.e);return a&&a._popContext(),c}if("function"==typeof u)return function(e){try{return s.call(e,"_promise0")}catch(e){return!1}}(e)?(c=new t(n),e._then(c._fulfill,c._reject,void 0,c,null),c):function(e,o,s){var a=new t(n),u=a;s&&s._pushContext(),a._captureStackTrace(),s&&s._popContext();var c=r.tryCatch(o).call(e,(function(e){a&&(a._resolveCallback(e),a=null)}),(function(e){a&&(a._rejectCallback(e,!1,!0),a=null)}));return a&&c===i&&(a._rejectCallback(c.e,!0,!0),a=null),u}(e,u,a)}return e}}},{"./util":36}],34:[function(e,t,n){"use strict";t.exports=function(t,n,r){var i=e("./util"),o=t.TimeoutError;function s(e){this.handle=e}s.prototype._resultCancelled=function(){clearTimeout(this.handle)};var a=function(e){return u(+this).thenReturn(e)},u=t.delay=function(e,i){var o,u;return void 0!==i?(o=t.resolve(i)._then(a,null,null,e,void 0),r.cancellation()&&i instanceof t&&o._setOnCancel(i)):(o=new t(n),u=setTimeout((function(){o._fulfill()}),+e),r.cancellation()&&o._setOnCancel(new s(u)),o._captureStackTrace()),o._setAsyncGuaranteed(),o};function c(e){return clearTimeout(this.handle),e}function l(e){throw clearTimeout(this.handle),e}t.prototype.delay=function(e){return u(e,this)},t.prototype.timeout=function(e,t){var n,a;e=+e;var u=new s(setTimeout((function(){n.isPending()&&function(e,t,n){var r;r="string"!=typeof t?t instanceof Error?t:new o("operation timed out"):new o(t),i.markAsOriginatingFromRejection(r),e._attachExtraTrace(r),e._reject(r),null!=n&&n.cancel()}(n,t,a)}),e));return r.cancellation()?(a=this.then(),(n=a._then(c,l,void 0,u,void 0))._setOnCancel(u)):n=this._then(c,l,void 0,u,void 0),n}}},{"./util":36}],35:[function(e,t,n){"use strict";t.exports=function(t,n,r,i,o,s){var a=e("./util"),u=e("./errors").TypeError,c=e("./util").inherits,l=a.errorObj,f=a.tryCatch,h={};function p(e){setTimeout((function(){throw e}),0)}function d(e,n){var i=0,s=e.length,a=new t(o);return function o(){if(i>=s)return a._fulfill();var u=function(e){var t=r(e);return t!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}(e[i++]);if(u instanceof t&&u._isDisposable()){try{u=r(u._getDisposer().tryDispose(n),e.promise)}catch(e){return p(e)}if(u instanceof t)return u._then(o,p,null,null,null)}o()}(),a}function v(e,t,n){this._data=e,this._promise=t,this._context=n}function y(e,t,n){this.constructor$(e,t,n)}function _(e){return v.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function m(e){this.length=e,this.promise=null,this[e-1]=null}v.prototype.data=function(){return this._data},v.prototype.promise=function(){return this._promise},v.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():h},v.prototype.tryDispose=function(e){var t=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=t!==h?this.doDispose(t,e):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},v.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},c(y,v),y.prototype.doDispose=function(e,t){return this.data().call(e,e,t)},m.prototype._resultCancelled=function(){for(var e=this.length,n=0;n<e;++n){var r=this[n];r instanceof t&&r.cancel()}},t.using=function(){var e=arguments.length;if(e<2)return n("you must pass at least 2 arguments to Promise.using");var i,o=arguments[e-1];if("function"!=typeof o)return n("expecting a function but got "+a.classString(o));var u=!0;2===e&&Array.isArray(arguments[0])?(e=(i=arguments[0]).length,u=!1):(i=arguments,e--);for(var c=new m(e),h=0;h<e;++h){var p=i[h];if(v.isDisposer(p)){var y=p;(p=p.promise())._setDisposable(y)}else{var g=r(p);g instanceof t&&(p=g._then(_,null,null,{resources:c,index:h},void 0))}c[h]=p}var b=new Array(c.length);for(h=0;h<b.length;++h)b[h]=t.resolve(c[h]).reflect();var k=t.all(b).then((function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n.isRejected())return l.e=n.error(),l;if(!n.isFulfilled())return void k.cancel();e[t]=n.value()}w._pushContext(),o=f(o);var r=u?o.apply(void 0,e):o(e),i=w._popContext();return s.checkForgottenReturns(r,i,"Promise.using",w),r})),w=k.lastly((function(){var e=new t.PromiseInspection(k);return d(c,e)}));return c.promise=w,w._setOnCancel(c),w},t.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},t.prototype._isDisposable=function(){return(131072&this._bitField)>0},t.prototype._getDisposer=function(){return this._disposer},t.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},t.prototype.disposer=function(e){if("function"==typeof e)return new y(e,this,i());throw new u}}},{"./errors":12,"./util":36}],36:[function(e,r,i){"use strict";var o=e("./es5"),s="undefined"==typeof navigator,a={e:{}},u,c="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==n?n:void 0!==this?this:null;function l(){try{var e=u;return u=null,e.apply(this,arguments)}catch(e){return a.e=e,a}}function f(e){return u=e,l}var h=function(e,t){var n={}.hasOwnProperty;function r(){for(var r in this.constructor=e,this.constructor$=t,t.prototype)n.call(t.prototype,r)&&"$"!==r.charAt(r.length-1)&&(this[r+"$"]=t.prototype[r])}return r.prototype=t.prototype,e.prototype=new r,e.prototype};function p(e){return null==e||!0===e||!1===e||"string"==typeof e||"number"==typeof e}function d(e){return"function"==typeof e||"object"==typeof e&&null!==e}function v(e){return p(e)?new Error(S(e)):e}function y(e,t){var n,r=e.length,i=new Array(r+1);for(n=0;n<r;++n)i[n]=e[n];return i[n]=t,i}function _(e,t,n){if(!o.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var r=Object.getOwnPropertyDescriptor(e,t);return null!=r?null==r.get&&null==r.set?r.value:n:void 0}function m(e,t,n){if(p(e))return e;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return o.defineProperty(e,t,r),e}function g(e){throw e}var b=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1};if(o.isES5){var n=Object.getOwnPropertyNames;return function(e){for(var r=[],i=Object.create(null);null!=e&&!t(e);){var s;try{s=n(e)}catch(e){return r}for(var a=0;a<s.length;++a){var u=s[a];if(!i[u]){i[u]=!0;var c=Object.getOwnPropertyDescriptor(e,u);null!=c&&null==c.get&&null==c.set&&r.push(u)}}e=o.getPrototypeOf(e)}return r}}var r={}.hasOwnProperty;return function(n){if(t(n))return[];var i=[];e:for(var o in n)if(r.call(n,o))i.push(o);else{for(var s=0;s<e.length;++s)if(r.call(e[s],o))continue e;i.push(o)}return i}}(),k=/this\s*\.\s*\S+\s*=/;function w(e){try{if("function"==typeof e){var t=o.names(e.prototype),n=o.isES5&&t.length>1,r=t.length>0&&!(1===t.length&&"constructor"===t[0]),i=k.test(e+"")&&o.names(e).length>0;if(n||r||i)return!0}return!1}catch(e){return!1}}function j(e){function t(){}t.prototype=e;var n=new t;function r(){return typeof n.foo}return r(),r(),e}var C=/^[a-z$_][a-z$_0-9]*$/i;function E(e){return C.test(e)}function T(e,t,n){for(var r=new Array(e),i=0;i<e;++i)r[i]=t+i+n;return r}function S(e){try{return e+""}catch(e){return"[no string representation]"}}function P(e){return e instanceof Error||null!==e&&"object"==typeof e&&"string"==typeof e.message&&"string"==typeof e.name}function F(e){try{m(e,"isOperational",!0)}catch(e){}}function x(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===e.isOperational)}function O(e){return P(e)&&o.propertyIsWritable(e,"stack")}var R="stack"in new Error?function(e){return O(e)?e:new Error(S(e))}:function(e){if(O(e))return e;try{throw new Error(S(e))}catch(e){return e}};function A(e){return{}.toString.call(e)}function I(e,t,n){for(var r=o.names(e),i=0;i<r.length;++i){var s=r[i];if(n(s))try{o.defineProperty(t,s,o.getDescriptor(e,s))}catch(e){}}}var U=function(e){return o.isArray(e)?e:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var D="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t,n=[],r=e[Symbol.iterator]();!(t=r.next()).done;)n.push(t.value);return n};U=function(e){return o.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?D(e):null}}var L=void 0!==t&&"[object process]"===A(t).toLowerCase(),B=void 0!==t&&void 0!==t.env,N;function M(e){return B?t.env[e]:void 0}function H(){if("function"==typeof Promise)try{if("[object Promise]"===A(new Promise((function(){}))))return Promise}catch(e){}}function V(e,t){if(null===e||"function"!=typeof t||t===N)return t;null!==e.domain&&(t=e.domain.bind(t));var n=e.async;if(null!==n){var r=t;t=function(){var e=new Array(2).concat([].slice.call(arguments));return e[0]=r,e[1]=this,n.runInAsyncScope.apply(n,e)}}return t}var W={setReflectHandler:function(e){N=e},isClass:w,isIdentifier:E,inheritedDataKeys:b,getDataPropertyOrDefault:_,thrower:g,isArray:o.isArray,asArray:U,notEnumerableProp:m,isPrimitive:p,isObject:d,isError:P,canEvaluate:s,errorObj:a,tryCatch:f,inherits:h,withAppended:y,maybeWrapAsError:v,toFastProperties:j,filledRange:T,toString:S,canAttachTrace:O,ensureErrorObject:R,originatesFromRejection:x,markAsOriginatingFromRejection:F,classString:A,copyDescriptors:I,isNode:L,hasEnvVariables:B,env:M,global:c,getNativePromise:H,contextBind:V},K;W.isRecentNode=W.isNode&&(t.versions&&t.versions.node?K=t.versions.node.split(".").map(Number):t.version&&(K=t.version.split(".").map(Number)),0===K[0]&&K[1]>10||K[0]>0),W.nodeSupportsAsyncResource=W.isNode&&function(){var t=!1;try{t="function"==typeof e("async_hooks").AsyncResource.prototype.runInAsyncScope}catch(e){t=!1}return t}(),W.isNode&&W.toFastProperties(t);try{throw new Error}catch(e){W.lastLineError=e}r.exports=W},{"./es5":13,async_hooks:void 0}]},{},[4])(4)},e.exports=i(),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,n(9),n(6),n(13).setImmediate)},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var u,c=[],l=!1,f=-1;function h(){l&&u&&(l=!1,u.length?c=u.concat(c):f=-1,c.length&&p())}function p(){if(!l){var e=a(h);l=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function v(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new d(e,t)),1!==c.length||l||a(p)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(e){var t=new URL(e).hostname.split(".");return t.slice(0).slice(-(4===t.length?3:2)).join(".")}},function(e,t,n){e.exports=n(17)},function(e,t){!function(e){"use strict";if(!e.fetch){var t="URLSearchParams"in e,n="Symbol"in e&&"iterator"in Symbol,r="FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in e,o="ArrayBuffer"in e;if(o)var s=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],a=function(e){return e&&DataView.prototype.isPrototypeOf(e)},u=ArrayBuffer.isView||function(e){return e&&s.indexOf(Object.prototype.toString.call(e))>-1};d.prototype.append=function(e,t){e=f(e),t=h(t);var n=this.map[e];this.map[e]=n?n+","+t:t},d.prototype.delete=function(e){delete this.map[f(e)]},d.prototype.get=function(e){return e=f(e),this.has(e)?this.map[e]:null},d.prototype.has=function(e){return this.map.hasOwnProperty(f(e))},d.prototype.set=function(e,t){this.map[f(e)]=h(t)},d.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},d.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),p(e)},d.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),p(e)},d.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),p(e)},n&&(d.prototype[Symbol.iterator]=d.prototype.entries);var c=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];b.prototype.clone=function(){return new b(this,{body:this._bodyInit})},g.call(b.prototype),g.call(w.prototype),w.prototype.clone=function(){return new w(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},w.error=function(){var e=new w(null,{status:0,statusText:""});return e.type="error",e};var l=[301,302,303,307,308];w.redirect=function(e,t){if(-1===l.indexOf(t))throw new RangeError("Invalid status code");return new w(null,{status:t,headers:{location:e}})},e.Headers=d,e.Request=b,e.Response=w,e.fetch=function(e,t){return new Promise((function(n,i){var o=new b(e,t),s=new XMLHttpRequest;s.onload=function(){var e,t,r={status:s.status,statusText:s.statusText,headers:(e=s.getAllResponseHeaders()||"",t=new d,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var n=e.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();t.append(r,i)}})),t)};r.url="responseURL"in s?s.responseURL:r.headers.get("X-Request-URL");var i="response"in s?s.response:s.responseText;n(new w(i,r))},s.onerror=function(){i(new TypeError("Network request failed"))},s.ontimeout=function(){i(new TypeError("Network request failed"))},s.open(o.method,o.url,!0),"include"===o.credentials?s.withCredentials=!0:"omit"===o.credentials&&(s.withCredentials=!1),"responseType"in s&&r&&(s.responseType="blob"),o.headers.forEach((function(e,t){s.setRequestHeader(t,e)})),s.send(void 0===o._bodyInit?null:o._bodyInit)}))},e.fetch.polyfill=!0}function f(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function h(e){return"string"!=typeof e&&(e=String(e)),e}function p(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function v(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function y(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function _(e){var t=new FileReader,n=y(t);return t.readAsArrayBuffer(e),n}function m(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function g(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(r&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(i&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(o&&r&&a(e))this._bodyArrayBuffer=m(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!o||!ArrayBuffer.prototype.isPrototypeOf(e)&&!u(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=m(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r&&(this.blob=function(){var e=v(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?v(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(_)}),this.text=function(){var e,t,n,r=v(this);if(r)return r;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=y(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(k)}),this.json=function(){return this.text().then(JSON.parse)},this}function b(e,t){var n,r,i=(t=t||{}).body;if(e instanceof b){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new d(e.headers)),this.method=e.method,this.mode=e.mode,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new d(t.headers)),this.method=(n=t.method||this.method||"GET",r=n.toUpperCase(),c.indexOf(r)>-1?r:n),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function k(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(i))}})),t}function w(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new d(t.headers),this.url=t.url||"",this._initBody(e)}}("undefined"!=typeof self?self:this)},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(14),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(6))},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,i,o,s,a,u=1,c={},l=!1,f=e.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(e);h=h&&h.setTimeout?h:e,"[object process]"==={}.toString.call(e.process)?r=function(e){t.nextTick((function(){d(e)}))}:!function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?e.MessageChannel?((o=new MessageChannel).port1.onmessage=function(e){d(e.data)},r=function(e){o.port2.postMessage(e)}):f&&"onreadystatechange"in f.createElement("script")?(i=f.documentElement,r=function(e){var t=f.createElement("script");t.onreadystatechange=function(){d(e),t.onreadystatechange=null,i.removeChild(t),t=null},i.appendChild(t)}):r=function(e){setTimeout(d,0,e)}:(s="setImmediate$"+Math.random()+"$",a=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(s)&&d(+t.data.slice(s.length))},e.addEventListener?e.addEventListener("message",a,!1):e.attachEvent("onmessage",a),r=function(t){e.postMessage(s+t,"*")}),h.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return c[u]=i,r(u),u++},h.clearImmediate=p}function p(e){delete c[e]}function d(e){if(l)setTimeout(d,0,e);else{var t=c[e];if(t){l=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{p(e),l=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(6),n(9))},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";n.r(t),n.d(t,"WallkitUser",(function(){return F})),n.d(t,"WallkitClient",(function(){return j})),n.d(t,"Config",(function(){return r.a})),n.d(t,"WallkitToken",(function(){return b})),n.d(t,"WallkitFirebase",(function(){return U}));var r=n(0),i={log:function(){var e;this.getDebugMode()&&(e=console).log.apply(e,arguments)},setDebugMode:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];"undefined"!=typeof localStorage&&localStorage.setItem("debug-wk-sdk",e)},getDebugMode:function(){return"undefined"!=typeof localStorage&&"true"===localStorage.getItem("debug-wk-sdk")}},o=(n(12),n(4)),s=n.n(o),a=n(7),u=n.n(a),c=n(8),l=n.n(c),f=n(1),h=n(2),p=n.n(h),d=n(3),v=n.n(d),y={getSessionKey:function(e){return e?v.a.formatKey("wk-session",e):"wk-session"},getSession:function(e){return p.a.getItem(y.getSessionKey(e))||f.a.getItem(y.getSessionKey(e))},setSession:function(e,t){p.a.setItem(y.getSessionKey(t),e),f.a.setItem(y.getSessionKey(t),e,1/0,"/",f.a.cookieDomain())},removeSession:function(e){f.a.removeItem(y.getSessionKey(e),"/",f.a.cookieDomain()),p.a.removeItem(y.getSessionKey(e))}},_=y;function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(i=r.key,o=void 0,o=function(e,t){if("object"!==m(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==m(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===m(o)?o:String(o)),r)}var i,o}var b=function(){function e(t){var n=t.value,r=t.refresh,i=t.expire,o=t.resource;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.value=n,this.refresh=r,this.expire=i,this.resource=o}var t,n,r;return t=e,(n=[{key:"getResource",get:function(){return"object"===m(this.resource)&&this.resource?this.resource.public_key:this.resource}},{key:"exist",value:function(){return!(!this.value||void 0===this.value)}},{key:"serialize",value:function(){return void 0!==this.value&&this.value&&f.a.setItem(e.getStorageKey(this.getResource),this.value,1/0,"/",f.a.cookieDomain()),void 0!==this.refresh&&f.a.setItem(e.getRefreshKey(this.getResource),this.refresh,1/0,"/",f.a.cookieDomain()),p.a.setItem(e.getStorageKey(this.getResource),JSON.stringify(this))}}])&&g(t.prototype,n),r&&g(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function k(e){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(i=r.key,o=void 0,o=function(e,t){if("object"!==k(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==k(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===k(o)?o:String(o)),r)}var i,o}b.storageKey="WallkitToken",b.storageRefreshKey="WallkitRefreshToken",b.getStorageKey=function(e){return e?v.a.formatKey(b.storageKey,e):b.storageKey},b.getRefreshKey=function(e){return e?v.a.formatKey(b.storageRefreshKey,e):b.storageKey},b.deserialize=function(e){var t=v.a.formatKey(b.storageKey,e),n=v.a.formatKey(b.storageRefreshKey,e),r=f.a.getItem(t),i=f.a.getItem(n);if(r||i)return new b({value:r,refresh:i,resource:e});var o=JSON.parse(p.a.getItem(t));return o&&o.value?(f.a.setItem(t,o.value,1/0,"/"),void 0!==o.refresh&&f.a.setItem(n,o.refresh,1/0,"/"),new b(o)):null},b.remove=function(e){var t=v.a.formatKey(b.storageKey,e),n=v.a.formatKey(b.storageRefreshKey,e);f.a.removeItem(t,"/",f.a.cookieDomain()),f.a.removeItem(n,"/",f.a.cookieDomain()),p.a.isAvailable()&&(p.a.removeItem(t),p.a.removeItem(n))};var j=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i;return t=e,(n=[{key:"token",get:function(){return(V.token||{}).value}},{key:"firebaseToken",get:function(){return V.firebase?V.firebase.getToken:null}},{key:"resource",get:function(){return r.a.resource}},{key:"session",get:function(){var e=_.getSession(this.resource);if(e)return e;var t=this.generateHash(32);return _.setSession(t,this.resource),t}},{key:"host",get:function(){return r.a.api_url}},{key:"get",value:function(e){var t=e.path,n=e.params,r=e.options;return this.makeRequest({path:t,params:n,options:r})}},{key:"resetCredentials",value:function(){_.removeSession(),b.remove(this.resource)}},{key:"post",value:function(e){var t=e.path,n=e.data,r=e.options;return this.makeRequest({path:t,method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"},options:r})}},{key:"nativePost",value:function(e){var t=e.path,n=e.data,r=e.options;return this.makeNativeRequest({path:t,method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"},options:r})}},{key:"postForm",value:function(e){var t=e.path,n=e.data,r=new FormData;try{Object.keys(n).forEach((function(e){r.append(e,n[e])}))}catch(e){console.log("post form error",e)}return this.makeRequest({path:t,method:"POST",body:r,headers:{}})}},{key:"put",value:function(e){var t=e.path,n=e.data;return this.makeRequest({path:t,method:"PUT",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}})}},{key:"del",value:function(e){var t=e.path;return this.makeRequest({path:t,method:"DELETE"})}},{key:"generateHash",value:function(e){for(var t="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=n.length,i=0;i<e;i++)t+=n.charAt(Math.floor(Math.random()*r));return t}},{key:"makeNativeRequest",value:function(e){var t=this,n=e.path,r=e.method,i=void 0===r?"GET":r,o=e.headers,a=void 0===o?{}:o,c=e.body,f=void 0===c?{}:c,h=e.options,p=void 0===h?{}:h;s()(a,{resource:this.resource}),s()(a,{"Wallkit-Client":"JsSDK v0.0.51"}),this.session&&s()(a,{session:this.session}),p.ignoreTokens||(this.token&&s()(a,{token:this.token}),this.firebaseToken&&s()(a,{"firebase-token":this.firebaseToken}));var d={method:i,headers:a};try{(u()(f).length>0||f instanceof FormData)&&s()(d,{body:f})}catch(e){console.log("make request error",e)}return fetch("".concat(this.host).concat(n),d).then((function(e){return e.status>=200&&e.status<300?e.json():new l.a((function(t,n){t(e.json())})).then((function(n){var r=new Error(e.statusText);if(r.response=n,401===r.statusCode&&(t.resetCredentials(),r.response))switch(r.response.error){case"token_compromised":t.resetCredentials()}throw r}))}))}},{key:"makeRequest",value:function(e){var t=this,n=e.path,r=e.method,i=void 0===r?"GET":r,o=e.headers,a=void 0===o?{}:o,c=e.body,f=void 0===c?{}:c,h=e.options,p=void 0===h?{}:h;s()(a,{resource:this.resource}),s()(a,{"Wallkit-Client":"JsSDK v0.0.51"}),this.session&&!p.ignoreSession&&s()(a,{session:this.session}),p.ignoreTokens||(this.token&&s()(a,{token:this.token}),this.firebaseToken&&s()(a,{"firebase-token":this.firebaseToken}));var d={method:i,headers:a};try{(u()(f).length>0||f instanceof FormData)&&s()(d,{body:f})}catch(e){console.log("make request error",e)}return fetch("".concat(this.host).concat(n),d).then((function(e){return e.status>=200&&e.status<300?e.json():l.a.resolve(e.json()).then((function(n){var r={};if((r=void 0!==n.error_description?new Error(n.error_description):new Error(e.statusText)).statusText=e.statusText,r.statusCode=e.status,r.requestUrl=e.url,r.response=n,401===r.statusCode&&r.response)switch(r.response.error){case"token_compromised":t.resetCredentials()}throw r}))}))}}])&&w(t.prototype,n),i&&w(t,i),Object.defineProperty(t,"prototype",{writable:!1}),e}()),C=n(5),E=n.n(C),T={send:function(e,t,n){var r={name:e,value:t,params:n},o=document.getElementsByTagName("iframe");if(window&&top&&window===top&&o.length)for(var s=0;s<o.length;s++)void 0!==o[s]&&o[s].contentWindow.postMessage(r,"*");else top.postMessage(r,"*");i.log("WkJsSDK ==>",r)}};function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(i=r.key,o=void 0,o=function(e,t){if("object"!==S(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==S(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===S(o)?o:String(o)),r)}var i,o}var F=function(){function e(t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.keys(t).forEach((function(e){Object.defineProperty(r,e,{value:t[e],enumerable:!0})})),n&&(void 0===this.token||E()(this.token)||T.send("wk-event-token",this.token),T.send("wk-event-user",this))}var t,n,r;return t=e,(n=[{key:"serialize",value:function(t){var n={id:this.id,active:this.active,confirm:this.confirm};return p.a.setItem(e.getStorageKey(t),JSON.stringify(n))}},{key:"isConfirmed",value:function(){return!!this.confirm}},{key:"plans",value:function(){return 0===this.subscriptions.length?[{title:"guest"}]:this.subscriptions.map((function(e){return e.plan}))}},{key:"hasPlan",value:function(e){return this.plans().includes(e)}},{key:"hasPaidSubscriptions",value:function(){if(this&&void 0!==this.subscriptions&&this.subscriptions.length)for(var e in this.subscriptions)if(void 0!==this.subscriptions[e]&&this.subscriptions[e].price>0)return!0;return!1}}])&&P(t.prototype,n),r&&P(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(i=r.key,o=void 0,o=function(e,t){if("object"!==x(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==x(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===x(o)?o:String(o)),r)}var i,o}F.storageKey="WallkitUser",F.getStorageKey=function(e){return e?v.a.formatKey(F.storageKey,e):F.storageKey},F.deserialize=function(e){var t=JSON.parse(p.a.getItem(F.getStorageKey(e)));return t&&t.id?new F(t):null},F.reload=function(){return j.get({path:"/user"})},F.remove=function(e){p.a.removeItem(F.getStorageKey(e))};var R=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.keys(t).forEach((function(e){Object.defineProperty(n,e,{value:t[e],enumerable:!0})})),void 0!==t.origin&&e.allOrigins.push(t.origin)}var t,n,r;return t=e,(n=[{key:"serialize",value:function(){return p.a.setItem(e.getStorageKey(this.public_key),JSON.stringify(this))}}])&&O(t.prototype,n),r&&O(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(i=r.key,o=void 0,o=function(e,t){if("object"!==A(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==A(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"),"symbol"===A(o)?o:String(o)),r)}var i,o}R.storageKey="WallkitResource",R.getStorageKey=function(e){return e?v.a.formatKey(R.storageKey,e):R.storageKey},R.allOrigins=["http://127.0.0.1:8000","https://wallkit.net","https://dev.wallkit.net","https://wallkit.local"],R.hasOrigin=function(e){return R.allOrigins.indexOf(e)>=0},R.getOrigins=function(){return R.allOrigins},R.deserialize=function(e){var t=JSON.parse(p.a.getItem(R.getStorageKey(e)));return t?new R(t):null},R.reload=function(){return j.get({path:"/resource"})};var U=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.enabled=!1!==n,this.resource=t,this.token=this.getStoredFirebaseToken()||null}var t,n,r;return t=e,(n=[{key:"tokenKey",get:function(){return"".concat("firebase-token","_").concat(this.resource)}},{key:"getToken",get:function(){return this.token||null}},{key:"setFirebaseToken",value:function(e){if(!e)throw new Error("Token is not provided");return this.token=e,this.storeFirebaseToken(e),e}},{key:"storeFirebaseToken",value:function(e){return p.a.setItem(this.tokenKey,e)}},{key:"getStoredFirebaseToken",value:function(){return p.a.getItem(this.tokenKey)||f.a.getItem(this.tokenKey)}},{key:"removeFirebaseTokenFromStorage",value:function(){return p.a.removeItem(this.tokenKey)}},{key:"removeFirebaseToken",value:function(){this.token=null,this.removeFirebaseTokenFromStorage(),this.removeFirebaseTokenFromCookie()}},{key:"removeFirebaseTokenFromCookie",value:function(){f.a.removeItem(this.tokenKey,"/",f.a.cookieDomain())}}])&&I(t.prototype,n),r&&I(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){B(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function B(e,t,n){return(t=H(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,H(r.key),r)}}function H(e){var t=function(e,t){if("object"!==N(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==N(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===N(t)?t:String(t)}var V=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initialized=!1}var t,n,o;return t=e,(n=[{key:"log",value:function(){var e;r.a.debug&&(e=console).log.apply(e,arguments)}},{key:"init",value:function(e){var t=e.resource,n=e.api_url,o=e.firebase,s=e.subDomainCookie,a=e.debug;return!!this.initialized||(r.a.resource=t,void 0!==n&&(r.a.api_url=n),void 0!==s&&(r.a.subDomainCookie=Boolean(s)),void 0!==a&&(r.a.debug=Boolean(a)),this.user=F.deserialize(t),this.token=b.deserialize(t),this.firebase=new U(t,o),this.resource=R.deserialize(t),(null===this.user&&this.token&&!1===this.firebase.enabled||null===this.user&&this.token&&this.firebase.token||!E()(this.user)&&!E()(this.user.token)&&!E()(this.token)&&!E()(this.firebase.token)&&this.user.token!==this.token.value)&&this.getUser().catch((function(e){})),!this.resource&&this.token&&this.getResource(),this.client=j,this.config=r.a,this.callbacks=[],this.initListener(),this.isLocalStorageAvailable=p.a.isAvailable(),i.setDebugMode(r.a.debug),this.initialized=!0)}},{key:"listener",value:function(e){if(void 0!==e.origin&&"undefined"!=typeof document&&R.hasOrigin(e.origin)&&e.origin!==document.location.origin&&"object"===N(e)&&"object"===N(e.data)&&void 0!==e.data.name&&void 0!==e.data.value)switch(this.log("WkJsSDK <==",e.data),e.data.name){case"wk-event-registration":case"wk-event-auth":case"wk-event-user":case"wk-event-user-update":case"wk-event-confirm-password":void 0!==e.data.value.token&&(this.token=new b({value:e.data.value.token,refresh:e.data.value.refresh_token,expire:e.data.value.expires,resource:r.a.resource}),this.token.serialize()),this.user=new F(e.data.value,!1),this.user.serialize(r.a.resource),this.dispatchLocalEvent("user",this.user);break;case"wk-firebase-token":this.setFirebaseToken(e.data.value);break;case"wk-event-token":this.token=new b({value:e.data.value,refresh:null,expire:null,resource:r.a.resource}),this.token.serialize(),this.getUser();break;case"wk-event-check-token":this.token&&void 0!==this.token.value&&T.send("wk-event-token",this.token.value)}}},{key:"initListener",value:function(){window.addEventListener?window.addEventListener("message",this.listener.bind(this)):window.attachEvent("onmessage",this.listener.bind(this))}},{key:"dispatchEvent",value:function(e,t){T.send(e,t)}},{key:"setToken",value:function(e){this.token=new b({value:e,resource:r.a.resource}),this.token.serialize()}},{key:"setFirebaseToken",value:function(e){this.firebase.setFirebaseToken(e)}},{key:"getToken",value:function(){return null===this.user||void 0===this.token||E()(this.user.token)?null===this.token||void 0===this.token||E()(this.token.value)?null:this.token.value:this.user.token}},{key:"getFirebaseToken",value:function(){return this.firebase.getToken}},{key:"isAuthenticated",value:function(){return!(!this.user||!this.token)}},{key:"checkAuth",value:function(){var e=this;return this.token?j.get({path:"/user"}).then((function(t){return e.user=new F(t,!0),e.user.serialize(r.a.resource),e.dispatchLocalEvent("user",e.user),!e.resource&&e.token&&e.getResource(),e.user})).catch((function(t){if(401===t.statusCode)throw e.token=null,e.user=null,e.firebase.removeFirebaseToken(),b.remove(r.a.resource),new Error("Unauthorized");return Promise.reject(t.response)})):Promise.reject("Unauthorized")}},{key:"registration",value:function(e){var t=this;return j.post({path:"/registration",data:e}).then((function(e){return t.token=new b({value:e.token,refresh:e.refresh_token,expire:e.expires,resource:r.a.resource}),t.token.serialize(),t.user=new F(e,!1),t.user.serialize(r.a.resource),t.dispatchLocalEvent("user",t.user),!t.resource&&t.token&&t.getResource(),T.send("wk-event-registration",e),t.user}))}},{key:"login",value:function(e){var t=this;return j.post({path:"/authorization",data:e}).then((function(e){return t.token=new b({value:e.token,refresh:e.refresh_token,expire:e.expires,resource:r.a.resource}),t.token.serialize(),t.user=new F(e,!1),t.user.serialize(r.a.resource),t.dispatchLocalEvent("user",t.user),!t.resource&&t.token&&t.getResource(),T.send("wk-event-auth",e),t.dispatchLocalEvent("auth",e),t.user})).catch((function(e){return Promise.reject(e)}))}},{key:"firebaseAccountSettings",value:function(){return j.get({path:"/firebase/account"}).then((function(e){return e.web_app_config})).catch((function(e){return Promise.reject(e)}))}},{key:"firebasePasswordReset",value:function(e){return e?j.post({path:"/firebase/password-reset",data:{email:e}}).then((function(e){return T.send("wk-event-firebase-password-reset",e),e})).catch((function(e){return Promise.reject(e)})):Promise.reject("Email is not provided")}},{key:"getReCaptchaSettings",value:function(){return j.get({path:"/integrations/resource/recaptcha-settings"}).then((function(e){return e})).catch((function(e){return Promise.reject(e)}))}},{key:"validateReCaptchaToken",value:function(e){return e?j.post({path:"/integrations/google-recaptcha/validate",data:{recaptcha_token:e},options:{ignoreTokens:!0,ignoreSession:!0}}).then((function(e){return T.send("wk-event-recaptcha-validate",e),e})).catch((function(e){return Promise.reject(e)})):Promise.reject("Token is not provided")}},{key:"getAuthTokensByTicketPassToken",value:function(e){return e?j.post({path:"/ti-event/ticket/pass/authorization",data:{authorization_token:e},options:{ignoreTokens:!0}}).then((function(e){return T.send("wk-event-ticket-pass-token",e),e})).catch((function(e){return Promise.reject(e)})):Promise.reject("Token is not provided")}},{key:"getAuthTokensByExternalUserId",value:function(e){return e?(e=window.btoa(e),j.get({path:"/auth/external/".concat(e),options:{ignoreTokens:!0}}).then((function(e){return T.send("wk-event-external-provider-token",e),e})).catch((function(e){return Promise.reject(e)}))):Promise.reject("External user id is not provided")}},{key:"authenticateWithFirebase",value:function(e,t){var n=this;if(!e)throw new Error("Token is not provided as argument");return this.setFirebaseToken(e),_.removeSession(),j.post({path:"/firebase/oauth/token",data:{recaptcha_token:t}}).then((function(t){return T.send("wk-event-firebase-auth",{wk_token:t.token,firebase_token:e}),n.authUserByToken(t.token),t})).catch((function(e){return n.firebase.removeFirebaseToken(),Promise.reject(e)}))}},{key:"verifyFirebaseToken",value:function(){var e=this;return j.post({path:"/firebase/verify-token"}).then((function(e){return e.status})).catch((function(t){return e.logout(!0),Promise.reject(t)}))}},{key:"logout",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.user=null,this.token?j.get({path:"/logout"}).then((function(e){return e})).finally((function(){e.token=null,F.remove(r.a.resource),b.remove(r.a.resource),e.firebase.removeFirebaseToken(),e.dispatchLocalEvent("logout"),t&&T.send("wk-event-logout",!0)})):new Promise((function(t){e.token=null,F.remove(r.a.resource),b.remove(r.a.resource),e.firebase.removeFirebaseToken(),t(!0)}))}},{key:"logoutFromFirebase",value:function(){var e=this,t=function(){e.token=null,F.remove(r.a.resource),b.remove(r.a.resource),_.removeSession(r.a.resource),e.firebase.removeFirebaseToken()};return T.send("wk-event-logout",!0),this.user=null,this.firebase.token?j.post({path:"/firebase/revoke-token"}).then((function(e){if(!0===e.status)return t(),!0})):new Promise((function(e){t(),e(!0)}))}},{key:"getUser",value:function(){var e=this;return F.reload().then((function(t){return e.user=new F(t,!0),e.user.serialize(r.a.resource),!e.resource&&e.token&&e.getResource(),e.dispatchLocalEvent("user",e.user),e.user})).catch((function(t){return 401===t.statusCode&&e.logout(!0),Promise.reject(t.response)}))}},{key:"authUserByToken",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!t)throw new Error("Incorrect token");return this.getToken()!==t&&(this.token=new b({value:t,resource:r.a.resource}),this.token.serialize(),T.send("wk-event-token",t)),this.getUser().then((function(t){return e.getResource(),t}))}},{key:"getResource",value:function(){var e=this;return R.reload().then((function(t){return e.resource=new R(t),e.resource.serialize(),T.send("wk-event-resource",t),e.dispatchLocalEvent("resource",t),e.resource})).catch((function(e){console.error("ERROR:",e),new Error("Resource not configured")}))}},{key:"getResources",value:function(){return this.client.get({path:"/resources"}).then((function(e){return T.send("wk-event-resources",e),e}))}},{key:"passwordReset",value:function(e){return"object"!==N(e)&&(e={email:e}),this.client.post({path:"/reset-password",data:e}).then((function(e){return T.send("wk-event-reset-password",e),e}))}},{key:"getSubscriptions",value:function(){return this.client.get({path:"/subscriptions"}).then((function(e){return T.send("wk-event-subscriptions",e),e}))}},{key:"changeUserSubscriptionAutorenewStatus",value:function(e,t){return this.client.put({path:"/user/subscriptions/".concat(e),data:{autorenew:t}}).then((function(e){return e}))}},{key:"changeUserSubscriptionSettings",value:function(e,t){if("number"!=typeof e)throw new Error("No subscription id provided!");if("object"!==N(t))throw new Error("No settings provided!");return this.client.put({path:"/user/subscriptions/".concat(e),data:L({},t)}).then((function(e){return e}))}},{key:"calculatePrice",value:function(e){return this.client.post({path:"/payment/calculate-price",data:e}).then((function(e){return T.send("wk-event-calculate-price",e),e}))}},{key:"checkOut",value:function(e){var t=this;return this.client.post({path:"/payment",data:e}).then((function(e){return t.getUser(),T.send("wk-event-transaction",e),e}))}},{key:"validatePromo",value:function(e){return"object"!==N(e)&&(e={promo:e}),this.client.post({path:"/promo-validation",data:e}).then((function(e){return T.send("wk-event-promo-validation",e),e}))}},{key:"getTransaction",value:function(e){return this.client.get({path:"/user/transactions/"+e}).then((function(e){return e}))}},{key:"getTransactions",value:function(){return this.client.get({path:"/user/transactions"}).then((function(e){return e}))}},{key:"updateUser",value:function(e){var t=this;return this.client.put({path:"/user",data:e}).then((function(e){return t.user=new F(e,!1),t.user.serialize(r.a.resource),T.send("wk-event-user-update",e),e})).catch((function(e){return 401===e.statusCode&&(t.token=null,t.user=null,t.logout(!0)),Promise.reject(e.response)}))}},{key:"socialRegistration",value:function(e){var t=this;return j.post({path:"/social-registration",data:e}).then((function(e){return t.token=new b({value:e.token,refresh:e.refresh_token,expire:e.expires,resource:r.a.resource}),t.token.serialize(),t.user=new F(e,!1),t.user.serialize(r.a.resource),t.dispatchLocalEvent("user",t.user),!t.resource&&t.token&&t.getResource(),T.send("wk-event-registration",e),t.user}))}},{key:"socialAuthorization",value:function(e){var t=this;return j.post({path:"/social-authorization",data:e}).then((function(e){return t.token=new b({value:e.token,refresh:e.refresh_token,expire:e.expires,resource:r.a.resource}),t.token.serialize(),t.user=new F(e,!1),t.user.serialize(r.a.resource),t.dispatchLocalEvent("user",t.user),!t.resource&&t.token&&t.getResource(),T.send("wk-event-auth",e),t.user})).catch((function(e){return Promise.reject(e)}))}},{key:"linkSocialAccount",value:function(e){if(!e)throw new Error("No data provided for social link");return j.put({path:"/user/social",data:e}).then((function(e){return e}))}},{key:"unlinkSocialAccount",value:function(e){if(!e)throw new Error("No data provided for social unlink");return"object"!==N(e)&&(e={method:e}),j.post({path:"/user/social/delete",data:e}).then((function(e){return e}))}},{key:"refreshToken",value:function(e){var t=this;return e||(e=this.token.refresh),"object"!==N(e)&&(e={refresh_token:e}),this.client.post({path:"/authorization/refresh",data:e}).then((function(e){return E()(e.token)||(t.token=new b({value:e.token,refresh:e.refresh_token,expire:e.expires,resource:r.a.resource}),t.token.serialize(),T.send("wk-event-token",e.token)),e}))}},{key:"updatePassword",value:function(e){return"object"!==N(e)&&(e={new_password:e}),this.client.put({path:"/user/password",data:e}).then((function(e){return T.send("wk-event-update-password",e),e}))}},{key:"updateEmail",value:function(e){return"object"!==N(e)&&(e={email:e}),this.client.put({path:"/user/email",data:e}).then((function(e){return T.send("wk-event-update-email",e),e}))}},{key:"getCampaignMonitorData",value:function(){return this.client.get({path:"/integrations/campaignmonitor/get-lists"}).then((function(e){return e}))}},{key:"getUserCampaignMonitorLists",value:function(){return this.client.get({path:"/integrations/campaignmonitor/interests"}).then((function(e){return e}))}},{key:"addUserToCampaignMonitorLists",value:function(e){return this.client.post({path:"/integrations/campaignmonitor/subscribe",data:e}).then((function(e){return e}))}},{key:"removeUserFromCampaignMonitorLists",value:function(e){return this.client.post({path:"/integrations/campaignmonitor/unsubscribe",data:e}).then((function(e){return e}))}},{key:"suspendMe",value:function(){return this.client.post({path:"/user/suspend"}).then((function(e){return T.send("wk-event-user-suspend",e),e}))}},{key:"confirmPassword",value:function(e){var t=this;return"object"!==N(e)&&(e={code:e}),this.client.post({path:"/confirm-password",data:e}).then((function(e){return E()(e.token)||(t.token=new b({value:e.token,refresh:e.refresh_token,expire:e.expires,resource:r.a.resource}),t.token.serialize(),t.user=new F(e,!0),t.user.serialize(r.a.resource),t.dispatchLocalEvent("user",t.user),!t.resource&&t.token&&t.getResource()),T.send("wk-event-confirm-password",e),e}))}},{key:"resendEmailConfirmation",value:function(){return this.client.post({path:"/resend-confirmation"}).then((function(e){return T.send("wk-event-resend-confirmation",e),e}))}},{key:"confirmEmail",value:function(e){return"object"!==N(e)&&(e={code:e}),this.client.post({path:"/confirm-email",data:e}).then((function(e){return T.send("wk-event-email-confirm",e),e}))}},{key:"removeCard",value:function(e){return this.client.del({path:"/user/card/"+e}).then((function(e){return T.send("wk-event-remove-card",e),e}))}},{key:"getCards",value:function(){var e=this;return this.client.get({path:"/user/cards"}).then((function(e){return T.send("wk-event-cards",e),e})).catch((function(t){return 401===t.statusCode&&(e.token=null,e.user=null,e.logout(!0)),Promise.reject(t.response)}))}},{key:"defaultCard",value:function(e){return this.client.post({path:"/user/card/"+e+"/default"}).then((function(e){return T.send("wk-event-default-card",e),e}))}},{key:"getCountries",value:function(){return this.client.get({path:"/countries"}).then((function(e){return T.send("wk-event-countries",e),e}))}},{key:"getCurrencies",value:function(){return this.client.get({path:"/currency"}).then((function(e){return T.send("wk-event-currency",e),e}))}},{key:"validateInvite",value:function(e){return"object"!==N(e)&&(e={invite:e}),this.client.post({path:"/invite-validation",data:e}).then((function(e){return T.send("wk-event-invite-validation",e),e}))}},{key:"activateInvite",value:function(e){return"object"!==N(e)&&(e={invite:e}),this.client.post({path:"/invite-activation",data:e}).then((function(e){return T.send("wk-event-invite-activation",e),e}))}},{key:"createStripeByToken",value:function(e){var t=this;return"object"!==N(e)&&(e={token:e}),this.client.post({path:"/user/stripe/token",data:e}).then((function(e){return T.send("wk-event-stripe-token",e),e})).catch((function(e){return 401===e.statusCode&&(t.token=null,t.user=null,t.logout(!0)),Promise.reject(e.response)}))}},{key:"confirmStripePaymentMethod",value:function(e){if(!e)throw new Error("No payment method id passed");return"object"!==N(e)&&(e={payment_method_id:e}),this.client.post({path:"/user/stripe/confirm-payment-method",data:e}).then((function(e){return T.send("wk-event-stripe-confirm-payment-method",e),e}))}},{key:"confirmStripePaymentIntent",value:function(e){if(!e)throw new Error("No payment intent id passed");return"object"!==N(e)&&(e={payment_intent_id:e}),this.client.post({path:"/payment/stripe/confirm-intent",data:e}).then((function(e){return T.send("wk-event-stripe-confirm-payment-intent",e),e}))}},{key:"setupStripeIntent",value:function(e){if(!e)throw new Error("No customer passed as argument");return"object"!==N(e)&&(e={customer:e}),this.client.post({path:"/payment/stripe/setup-intent",data:e}).then((function(e){return T.send("wk-event-setup-intent",e),e}))}},{key:"removeStripeCustomer",value:function(e){if(!e)throw new Error("No customer id passed as argument");return this.client.del({path:"/user/stripe/customer/".concat(e)}).then((function(e){return T.send("wk-event-stripe-customer-delete",e),e}))}},{key:"validateEmail",value:function(e){return"object"!==N(e)&&(e={email:e}),this.client.post({path:"/email-validation",data:e}).then((function(e){return T.send("wk-event-email-validation",e),e}))}},{key:"checkAccess",value:function(e){var t=this;return void 0===e?Promise.reject("Incorrect content key"):this.client.get({path:"/user/content/"+e}).then((function(e){return e})).catch((function(e){return 401===e.statusCode&&(t.token=null,t.user=null,t.logout(!0)),Promise.reject(e.response)}))}},{key:"getAccessDetails",value:function(e){return void 0===e?Promise.reject("Incorrect content key"):this.client.get({path:"/user/content-access-details/"+e}).then((function(e){return T.send("wk-event-access-details",e),e})).catch((function(e){return Promise.reject(e)}))}},{key:"sendEvent",value:function(e){if("object"!==N(e))throw new Error("Event data must be an object.");return this.client.post({path:"/user/event",data:e})}},{key:"sendPageView",value:function(e,t){if(!e)throw new Error("No argument passed");return"object"!==N(e)?e={name:"page_view",value:e,content_key:t}:void 0!==e.name&&"page_view"===e.name||(e.name="page_view"),this.sendEvent(e)}},{key:"subscribeLocalEvent",value:function(e,t){this.callbacks.push({event:e,callback:t})}},{key:"unsubscribeLocalEvent",value:function(e,t){this.callbacks=this.callbacks.filter((function(n){if(n.event!==e&&n.callback!==t)return!0}))}},{key:"dispatchLocalEvent",value:function(e,t){var n=this;this.callbacks.length>0&&this.callbacks.map((function(r){if(r.event&&r.event===e&&r.callback)try{r.callback(t)}catch(e){n.log("Error",e)}}))}},{key:"updateUserFirestore",value:function(e){return this.client.put({path:"/firebase/firestore/user",data:{firestore:e}}).then((function(e){return T.send("wk-event-firestore-update",e),e})).catch((function(e){return Promise.reject(e)}))}},{key:"getTicketsEvents",value:function(){return this.client.get({path:"/ti-events"}).then((function(e){return T.send("wk-event-tickets",e),e}))}},{key:"getTickets",value:function(e){return this.client.get({path:"/ti-event/".concat(e,"/tickets")}).then((function(e){return T.send("wk-tickets",e),e}))}},{key:"getUserPassesTickets",value:function(e){return this.client.get({path:"/user/ti-event/".concat(e,"/passes")}).then((function(e){return T.send("wk-tickets-passes",e),e}))}},{key:"assignTicket",value:function(e,t){return this.client.put({path:"/user/pass/".concat(e,"/assign"),data:{assign_id:t}}).then((function(e){return T.send("wk-tickets",e),e}))}},{key:"sendTicketPassInviteToUser",value:function(e,t){return this.client.post({path:"/user/pass/".concat(e,"/invite"),data:{email:t}}).then((function(e){return T.send("wk-send-ticket-pass-invite",e),e}))}},{key:"validateTicketPassInvite",value:function(e){return this.client.post({path:"/ti-event/pass/invite-validation",data:{code:e}}).then((function(e){return T.send("wk-validate-ticket-pass-invite",e),e}))}},{key:"activateTicketPassInvite",value:function(e){return this.client.post({path:"/ti-event/pass/invite-activation",data:{code:e}}).then((function(e){return T.send("wk-activate-ticket-pass-invite",e),e}))}},{key:"removeTicketPassInvite",value:function(e){return this.client.del({path:"/user/pass/".concat(e,"/invite")}).then((function(e){return T.send("wk-removed-ticket-pass-invite",e),e}))}},{key:"getUserTickets",value:function(){return this.client.get({path:"/user/ti-event-tickets"}).then((function(e){return T.send("wk-user-tickets",e),e}))}},{key:"assignMailchimpTags",value:function(e){return this.client.post({path:"/integrations/mailchimp/add-tags",data:{insert_tags:e}}).then((function(e){return T.send("wk-mailchimp-assign-tags",e),e}))}},{key:"getTicketPassInfo",value:function(e){return this.client.get({path:"/user/pass/".concat(e)}).then((function(e){return T.send("wk-ticket-pass-info",e),e}))}},{key:"cardAttemptAttach",value:function(){return this.client.post({path:"/user/card/attempt-attach"}).then((function(e){return T.send("wk-attempt-attach",e),e}))}},{key:"checkUserFirebaseRelation",value:function(e,t){if(!e)throw new Error("Email is not provided.");var n=new URLSearchParams({email:e});return Array.isArray(t)&&t.forEach((function(e){n.set("resources[]",e)})),this.client.get({path:"/firebase/check/email?".concat(n)}).then((function(e){return T.send("wk-check-user-firebase-relation",e),e}))}},{key:"cascadeAccess",value:function(){return this.client.get({path:"/user/cascade-access"}).then((function(e){return T.send("wk-cascade-access",e),e}))}},{key:"checkUserActivity",value:function(e){if(!e)throw new Error("Email is not provided.");return this.client.post({path:"/check-user-activity",data:{email:e}}).then((function(e){return T.send("wk-check-user-activity",e),e}))}},{key:"stripePaymentElementsGetCustomer",value:function(){return this.client.get({path:"/user/payment-provider/stripe/customer"}).then((function(e){return T.send("wk-event-stripe-payment-elements-get-customer",e),e})).catch((function(e){return T.send("wk-event-stripe-payment-elements-get-customer",e.response),Promise.reject(e.response)}))}},{key:"stripePaymentElementsSetupIntents",value:function(e){if(!e)throw new Error("No wallkit customer passed as argument");var t=e.payment_customer.customer_id;if(!t)throw new Error("No stripe customer id passed as argument");return this.client.post({path:"/user/payment-provider/stripe/setup-intents",data:{stripe_customer_id:t}}).then((function(e){return T.send("wk-event-stripe-payment-elements-setup-intents",e),e})).catch((function(e){return T.send("wk-event-stripe-payment-elements-setup-intents",e.response),Promise.reject(e.response)}))}},{key:"stripePaymentElementsSaveIntents",value:function(e){if(!e)throw new Error("No confirmedSetupIntent passed as argument");return this.client.post({path:"/user/payment-provider/stripe/save-intents",data:{setup_intent:e}}).then((function(e){return T.send("wk-event-stripe-payment-elements-save-intents",e),e})).catch((function(e){return T.send("wk-event-stripe-payment-elements-save-intents",e.response),Promise.reject(e.response)}))}},{key:"stripePaymentElementsGetPaymentSources",value:function(){return this.client.get({path:"/user/payment-sources"}).then((function(e){return T.send("wk-event-stripe-payment-elements-payment-sources",e),e})).catch((function(e){return T.send("wk-event-stripe-payment-elements-payment-sources",e.response),Promise.reject(e.response)}))}},{key:"stripePaymentElementsDefaultPaymentSource",value:function(e,t){if(!e)throw new Error("No payment source id passed as argument");if(!["payment-method","user-card"].includes(t))throw new Error("Incorrect source type passed as argument");return this.client.put({path:"/user/payment-sources/".concat(t,"/").concat(e,"/default")}).then((function(e){return T.send("wk-event-stripe-payment-elements-default-payment-source",e),e})).catch((function(e){return T.send("wk-event-stripe-payment-elements-default-payment-source",e.response),Promise.reject(e.response)}))}},{key:"stripePaymentElementsRemovePaymentSource",value:function(e,t){if(!e)throw new Error("No payment source id passed as argument");if(!["payment-method","user-card"].includes(t))throw new Error("Incorrect source type passed as argument");return this.client.del({path:"/user/payment-sources/".concat(t,"/").concat(e)}).then((function(e){return T.send("wk-event-stripe-payment-elements-remove-payment-sources",e),e})).catch((function(e){return T.send("wk-event-stripe-payment-elements-remove-payment-sources",e.response),Promise.reject(e.response)}))}}])&&M(t.prototype,n),o&&M(t,o),Object.defineProperty(t,"prototype",{writable:!1}),e}());function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.default=V;null==("undefined"==typeof window?"undefined":W(window))||window.Wallkit||(window.Wallkit=V)}]);void 0===Wallkit&&console.error("esm-webpack-plugin: nothing exported!");export default Wallkit.default;const _Wallkit$WallkitUser=Wallkit.WallkitUser,_Wallkit$WallkitClient=Wallkit.WallkitClient,_Wallkit$Config=Wallkit.Config,_Wallkit$WallkitToken=Wallkit.WallkitToken,_Wallkit$WallkitFirebase=Wallkit.WallkitFirebase;export{_Wallkit$WallkitUser as WallkitUser,_Wallkit$WallkitClient as WallkitClient,_Wallkit$Config as Config,_Wallkit$WallkitToken as WallkitToken,_Wallkit$WallkitFirebase as WallkitFirebase};